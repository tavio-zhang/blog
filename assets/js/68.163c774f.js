(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{423:function(s,t,a){"use strict";a.r(t);var n=a(8),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("Redis位图（Bitmap）是一种基于字符串类型的高效数据结构，它通过将字符串中的每个字节拆分为8个二进制位（bit），利用这些bit位来表示和存储布尔类型的信息（0或1）。相比传统的字符串、哈希等结构，Bitmap在存储海量布尔型数据时具有极高的空间效率，同时支持高效的位运算操作，广泛应用于用户签到、在线状态判断、数据统计等场景。")]),s._v(" "),t("h2",{attrs:{id:"一、核心概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、核心概念"}},[s._v("#")]),s._v(" 一、核心概念")]),s._v(" "),t("h3",{attrs:{id:"_1-1-本质"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-本质"}},[s._v("#")]),s._v(" 1.1 本质")]),s._v(" "),t("p",[s._v("Bitmap的本质是Redis的字符串（String）类型，因为Redis的字符串是二进制安全的，其底层存储的是字节序列。Bitmap通过对这些字节序列的bit位进行操作，实现了“以bit为单位”的数据存储和管理。例如，一个长度为1的字符串（1字节）可以表示8个bit位，对应8个布尔值；长度为2的字符串可以表示16个bit位，以此类推。")]),s._v(" "),t("h3",{attrs:{id:"_1-2-核心优势"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-核心优势"}},[s._v("#")]),s._v(" 1.2 核心优势")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("空间效率极高")]),s._v("：1个字节可存储8个布尔值，相比使用哈希表（Hash）存储（每个键值对至少占用几十字节），空间占用降低一个数量级。例如，存储1000万用户的签到状态，仅需约1.2MB（10000000 / 8 / 1024 ≈ 1220KB）。")]),s._v(" "),t("li",[t("strong",[s._v("操作高效")]),s._v("：支持单个bit位的快速设置、查询，以及多个Bitmap之间的位运算（与、或、异或等），所有操作的时间复杂度均为O(1)或O(n)（n为bit位长度，效率远高于其他结构）。")]),s._v(" "),t("li",[t("strong",[s._v("兼容性好")]),s._v("：基于String类型实现，无需额外的底层存储支持，所有支持Redis String的客户端均可直接操作Bitmap。")])]),s._v(" "),t("h3",{attrs:{id:"_1-3-适用场景特征"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-适用场景特征"}},[s._v("#")]),s._v(" 1.3 适用场景特征")]),s._v(" "),t("p",[s._v("适合存储“是否”型数据（如是否签到、是否在线、是否读过某篇文章），且数据标识为连续或可枚举的整数（如用户ID、日期偏移量、商品ID）。若数据标识为非整数（如用户名、UUID），需先进行映射转换为整数，否则无法高效使用Bitmap。")]),s._v(" "),t("h2",{attrs:{id:"二、核心命令详解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二、核心命令详解"}},[s._v("#")]),s._v(" 二、核心命令详解")]),s._v(" "),t("p",[s._v("Redis提供了一系列专门用于操作Bitmap的命令，涵盖bit位的设置、查询、统计、位运算等核心功能。以下是常用命令的详细说明：")]),s._v(" "),t("h3",{attrs:{id:"_2-1-setbit-设置指定bit位的值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-setbit-设置指定bit位的值"}},[s._v("#")]),s._v(" 2.1 SETBIT：设置指定bit位的值")]),s._v(" "),t("h4",{attrs:{id:"_2-1-1-语法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-语法"}},[s._v("#")]),s._v(" 2.1.1 语法")]),s._v(" "),t("p",[s._v("SETBIT key offset value")]),s._v(" "),t("h4",{attrs:{id:"_2-1-2-参数说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-参数说明"}},[s._v("#")]),s._v(" 2.1.2 参数说明")]),s._v(" "),t("ul",[t("li",[s._v("key：Bitmap对应的键名。")]),s._v(" "),t("li",[s._v("offset：bit位的偏移量，从0开始（0表示第一个bit位），支持非负整数（理论上无上限，仅受Redis内存限制）。")]),s._v(" "),t("li",[s._v("value：待设置的bit值，只能是0或1。")])]),s._v(" "),t("h4",{attrs:{id:"_2-1-3-功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-3-功能"}},[s._v("#")]),s._v(" 2.1.3 功能")]),s._v(" "),t("p",[s._v("将key对应的Bitmap中，偏移量为offset的bit位设置为value。若key不存在，会先创建一个空字符串（所有bit位默认值为0）；若offset超过当前字符串的长度，Redis会自动在字符串末尾补0，直到长度足以覆盖offset对应的bit位。")]),s._v(" "),t("h4",{attrs:{id:"_2-1-4-返回值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-4-返回值"}},[s._v("#")]),s._v(" 2.1.4 返回值")]),s._v(" "),t("p",[s._v("该bit位在设置前的旧值（0或1）。")]),s._v(" "),t("h4",{attrs:{id:"_2-1-5-示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-5-示例"}},[s._v("#")]),s._v(" 2.1.5 示例")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置用户ID为100的用户在2026-01-13的签到状态为1（已签到）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 键名：sign:20260113（表示2026年01月13日的签到表）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 偏移量：100（用户ID），值：1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" SETBIT sign:20260113 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 该bit位之前为0（未签到）")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 再次设置同一偏移量，返回旧值1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" SETBIT sign:20260113 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h3",{attrs:{id:"_2-2-getbit-获取指定bit位的值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-getbit-获取指定bit位的值"}},[s._v("#")]),s._v(" 2.2 GETBIT：获取指定bit位的值")]),s._v(" "),t("h4",{attrs:{id:"_2-2-1-语法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-语法"}},[s._v("#")]),s._v(" 2.2.1 语法")]),s._v(" "),t("p",[s._v("GETBIT key offset")]),s._v(" "),t("h4",{attrs:{id:"_2-2-2-参数说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-参数说明"}},[s._v("#")]),s._v(" 2.2.2 参数说明")]),s._v(" "),t("ul",[t("li",[s._v("key：Bitmap对应的键名。")]),s._v(" "),t("li",[s._v("offset：bit位的偏移量（从0开始）。")])]),s._v(" "),t("h4",{attrs:{id:"_2-2-3-功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-功能"}},[s._v("#")]),s._v(" 2.2.3 功能")]),s._v(" "),t("p",[s._v("获取key对应的Bitmap中，偏移量为offset的bit位的值。若key不存在，视为所有bit位为0的Bitmap；若offset超过当前字符串的长度，返回0。")]),s._v(" "),t("h4",{attrs:{id:"_2-2-4-返回值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-4-返回值"}},[s._v("#")]),s._v(" 2.2.4 返回值")]),s._v(" "),t("p",[s._v("指定bit位的值（0或1）。")]),s._v(" "),t("h4",{attrs:{id:"_2-2-5-示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-5-示例"}},[s._v("#")]),s._v(" 2.2.5 示例")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取用户ID100在2026-01-13的签到状态")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" GETBIT sign:20260113 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 已签到")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取不存在的用户ID200的签到状态（返回0）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" GETBIT sign:20260113 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h3",{attrs:{id:"_2-3-bitcount-统计指定范围内的1的个数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-bitcount-统计指定范围内的1的个数"}},[s._v("#")]),s._v(" 2.3 BITCOUNT：统计指定范围内的1的个数")]),s._v(" "),t("h4",{attrs:{id:"_2-3-1-语法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-1-语法"}},[s._v("#")]),s._v(" 2.3.1 语法")]),s._v(" "),t("p",[s._v("BITCOUNT key [start end]")]),s._v(" "),t("h4",{attrs:{id:"_2-3-2-参数说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-2-参数说明"}},[s._v("#")]),s._v(" 2.3.2 参数说明")]),s._v(" "),t("ul",[t("li",[s._v("key：Bitmap对应的键名。")]),s._v(" "),t("li",[s._v("start/end：可选参数，指定统计的字节范围（注意：是字节范围，不是bit位范围），默认统计整个字符串的所有字节。start和end支持负数，-1表示最后一个字节，-2表示倒数第二个字节，以此类推。")])]),s._v(" "),t("h4",{attrs:{id:"_2-3-3-功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-3-功能"}},[s._v("#")]),s._v(" 2.3.3 功能")]),s._v(" "),t("p",[s._v("统计key对应的Bitmap中，指定字节范围内所有bit位中值为1的个数。若需要统计指定bit位范围，需先将bit位范围转换为字节范围（例如，统计bit 0-15，对应字节0-1）。")]),s._v(" "),t("h4",{attrs:{id:"_2-3-4-返回值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-4-返回值"}},[s._v("#")]),s._v(" 2.3.4 返回值")]),s._v(" "),t("p",[s._v("指定范围内1的个数。")]),s._v(" "),t("h4",{attrs:{id:"_2-3-5-示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-5-示例"}},[s._v("#")]),s._v(" 2.3.5 示例")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 统计2026-01-13的总签到人数（所有bit位中1的个数）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" BITCOUNT sign:20260113\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("568")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当天有568人签到")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 统计前10个字节（对应bit 0-79）中1的个数（即用户ID 0-79中的签到人数）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" BITCOUNT sign:20260113 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h3",{attrs:{id:"_2-4-bitop-对多个bitmap执行位运算"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-bitop-对多个bitmap执行位运算"}},[s._v("#")]),s._v(" 2.4 BITOP：对多个Bitmap执行位运算")]),s._v(" "),t("h4",{attrs:{id:"_2-4-1-语法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-1-语法"}},[s._v("#")]),s._v(" 2.4.1 语法")]),s._v(" "),t("p",[s._v("BITOP operation destkey key [key ...]")]),s._v(" "),t("h4",{attrs:{id:"_2-4-2-参数说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-2-参数说明"}},[s._v("#")]),s._v(" 2.4.2 参数说明")]),s._v(" "),t("ul",[t("li",[s._v("operation：位运算类型，支持AND（与）、OR（或）、XOR（异或）、NOT（非）。注意：NOT运算仅支持单个key，其他运算支持多个key。")]),s._v(" "),t("li",[s._v("destkey：运算结果存储的目标键名（会覆盖已有键）。")]),s._v(" "),t("li",[s._v("key [key ...]：参与运算的源Bitmap键名。")])]),s._v(" "),t("h4",{attrs:{id:"_2-4-3-功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-3-功能"}},[s._v("#")]),s._v(" 2.4.3 功能")]),s._v(" "),t("p",[s._v("对多个源Bitmap执行指定的位运算，将结果存储到destkey中。当多个源Bitmap的长度不一致时，Redis会以最长的Bitmap为准，较短的Bitmap在末尾补0后再进行运算。")]),s._v(" "),t("h4",{attrs:{id:"_2-4-4-返回值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-4-返回值"}},[s._v("#")]),s._v(" 2.4.4 返回值")]),s._v(" "),t("p",[s._v("目标键destkey对应的字符串长度（以字节为单位）。")]),s._v(" "),t("h4",{attrs:{id:"_2-4-5-示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-5-示例"}},[s._v("#")]),s._v(" 2.4.5 示例")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 场景：统计2026-01-13和2026-01-14两天都签到的用户（交集）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 假设已有两天的签到Bitmap：sign:20260113、sign:20260114")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 执行AND运算，结果存入sign:20260113_14_both")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" BITOP AND sign:20260113_14_both sign:20260113 sign:20260114\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1250")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 结果Bitmap长度为1250字节（对应10000个bit位，即支持10000个用户ID）")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3. 统计两天都签到的人数")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" BITCOUNT sign:20260113_14_both\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("320")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 320人连续两天签到")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 场景：统计2026-01-13或2026-01-14至少签到一天的用户（并集）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" BITOP OR sign:20260113_14_either sign:20260113 sign:20260114\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1250")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" BITCOUNT sign:20260113_14_either\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("780")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 780人至少签到一天")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h3",{attrs:{id:"_2-5-bitpos-查找指定值的第一个bit位偏移量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-bitpos-查找指定值的第一个bit位偏移量"}},[s._v("#")]),s._v(" 2.5 BITPOS：查找指定值的第一个bit位偏移量")]),s._v(" "),t("h4",{attrs:{id:"_2-5-1-语法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-1-语法"}},[s._v("#")]),s._v(" 2.5.1 语法")]),s._v(" "),t("p",[s._v("BITPOS key value [start end]")]),s._v(" "),t("h4",{attrs:{id:"_2-5-2-参数说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-2-参数说明"}},[s._v("#")]),s._v(" 2.5.2 参数说明")]),s._v(" "),t("ul",[t("li",[s._v("key：Bitmap对应的键名。")]),s._v(" "),t("li",[s._v("value：要查找的bit值（0或1）。")]),s._v(" "),t("li",[s._v("start/end：可选参数，指定查找的字节范围（默认查找整个字符串），支持负数（-1表示最后一个字节）。")])]),s._v(" "),t("h4",{attrs:{id:"_2-5-3-功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-3-功能"}},[s._v("#")]),s._v(" 2.5.3 功能")]),s._v(" "),t("p",[s._v("在key对应的Bitmap中，查找指定字节范围内第一个值为value的bit位的偏移量。若未找到，返回-1。")]),s._v(" "),t("h4",{attrs:{id:"_2-5-4-返回值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-4-返回值"}},[s._v("#")]),s._v(" 2.5.4 返回值")]),s._v(" "),t("p",[s._v("第一个符合条件的bit位偏移量，未找到则返回-1。")]),s._v(" "),t("h4",{attrs:{id:"_2-5-5-示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-5-示例"}},[s._v("#")]),s._v(" 2.5.5 示例")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查找2026-01-13第一个签到的用户（第一个值为1的bit位）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" BITPOS sign:20260113 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用户ID为5的用户是当天第一个签到的")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查找2026-01-13中，字节10-20（bit 80-160）范围内第一个未签到的用户（值为0的bit位）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" BITPOS sign:20260113 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("83")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用户ID为83的用户未签到，且是该范围内第一个未签到的")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h2",{attrs:{id:"三、典型使用场景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三、典型使用场景"}},[s._v("#")]),s._v(" 三、典型使用场景")]),s._v(" "),t("p",[s._v("Bitmap的空间效率和高效位运算特性，使其在多个场景中具有不可替代的优势。以下是最常见的应用场景：")]),s._v(" "),t("h3",{attrs:{id:"_3-1-用户签到统计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-用户签到统计"}},[s._v("#")]),s._v(" 3.1 用户签到统计")]),s._v(" "),t("h4",{attrs:{id:"_3-1-1-场景需求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-场景需求"}},[s._v("#")]),s._v(" 3.1.1 场景需求")]),s._v(" "),t("p",[s._v("记录用户每天的签到状态，支持查询单个用户某天是否签到、统计用户连续签到天数、统计某一天的总签到人数、统计某段时间内的签到次数等。")]),s._v(" "),t("h4",{attrs:{id:"_3-1-2-实现方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-2-实现方案"}},[s._v("#")]),s._v(" 3.1.2 实现方案")]),s._v(" "),t("ul",[t("li",[s._v("键名设计：以“sign:日期”为键名（如sign:20260113），日期格式为年月日（YYYYMMDD）。")]),s._v(" "),t("li",[s._v("偏移量设计：以用户ID为偏移量（假设用户ID为整数）。")]),s._v(" "),t("li",[s._v("值设计：1表示已签到，0表示未签到。")])]),s._v(" "),t("h4",{attrs:{id:"_3-1-3-核心操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-3-核心操作"}},[s._v("#")]),s._v(" 3.1.3 核心操作")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 用户ID 100 2026-01-13 签到")]),s._v("\nSETBIT sign:20260113 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 查询用户ID 100 2026-01-13 是否签到")]),s._v("\nGETBIT sign:20260113 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3. 统计2026-01-13 总签到人数")]),s._v("\nBITCOUNT sign:20260113\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4. 统计用户ID 100 2026年1月（1-31日）的签到次数")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 遍历1-31日的键，执行GETBIT并累加1的个数")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或使用BITOP OR合并31天的Bitmap，再统计1的个数（但需注意合并后无法区分具体天数）")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5. 统计用户ID 100 连续签到天数（从当前日期往前推）")]),s._v("\ncurrent_date "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20260113")]),s._v("\ncontinuous_days "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" True:\n    key "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" f"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sign:{current_date}"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" GETBIT key "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":\n        continuous_days "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n        current_date "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 前一天日期\n    else:\n        "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("break")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("h3",{attrs:{id:"_3-2-用户在线状态判断"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-用户在线状态判断"}},[s._v("#")]),s._v(" 3.2 用户在线状态判断")]),s._v(" "),t("h4",{attrs:{id:"_3-2-1-场景需求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-场景需求"}},[s._v("#")]),s._v(" 3.2.1 场景需求")]),s._v(" "),t("p",[s._v("实时记录用户的在线/离线状态，支持快速查询单个用户状态、统计当前在线用户总数。")]),s._v(" "),t("h4",{attrs:{id:"_3-2-2-实现方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-实现方案"}},[s._v("#")]),s._v(" 3.2.2 实现方案")]),s._v(" "),t("ul",[t("li",[s._v("键名设计：使用固定键名（如online:status），无需按日期拆分（因为状态是实时更新的）。")]),s._v(" "),t("li",[s._v("偏移量设计：以用户ID为偏移量。")]),s._v(" "),t("li",[s._v("值设计：1表示在线，0表示离线。")])]),s._v(" "),t("h4",{attrs:{id:"_3-2-3-核心操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-核心操作"}},[s._v("#")]),s._v(" 3.2.3 核心操作")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 用户ID 200 上线，设置状态为1")]),s._v("\nSETBIT online:status "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 用户ID 200 下线，设置状态为0")]),s._v("\nSETBIT online:status "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3. 查询用户ID 200 是否在线")]),s._v("\nGETBIT online:status "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4. 统计当前在线用户总数")]),s._v("\nBITCOUNT online:status\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("优势：相比使用Hash存储（如online:user {200:1, 201:0}），Bitmap节省90%以上的空间，且统计在线人数的效率更高（BITCOUNT vs HCOUNT）。")]),s._v(" "),t("h3",{attrs:{id:"_3-3-数据权限控制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-数据权限控制"}},[s._v("#")]),s._v(" 3.3 数据权限控制")]),s._v(" "),t("h4",{attrs:{id:"_3-3-1-场景需求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-1-场景需求"}},[s._v("#")]),s._v(" 3.3.1 场景需求")]),s._v(" "),t("p",[s._v("控制用户对多个资源的访问权限（如菜单、接口、文件），支持快速判断用户是否拥有某资源的权限，以及统计拥有某资源权限的用户数。")]),s._v(" "),t("h4",{attrs:{id:"_3-3-2-实现方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-实现方案"}},[s._v("#")]),s._v(" 3.3.2 实现方案")]),s._v(" "),t("ul",[t("li",[s._v("键名设计：以“permission:资源ID”为键名（如permission:menu:101，表示菜单101的权限表）。")]),s._v(" "),t("li",[s._v("偏移量设计：以用户ID为偏移量。")]),s._v(" "),t("li",[s._v("值设计：1表示拥有权限，0表示无权限。")])]),s._v(" "),t("h4",{attrs:{id:"_3-3-3-核心操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-3-核心操作"}},[s._v("#")]),s._v(" 3.3.3 核心操作")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 给用户ID 300 分配菜单101的权限")]),s._v("\nSETBIT permission:menu:101 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 撤销用户ID 300 对菜单101的权限")]),s._v("\nSETBIT permission:menu:101 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3. 判断用户ID 300 是否能访问菜单101")]),s._v("\nGETBIT permission:menu:101 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4. 统计拥有菜单101权限的用户总数")]),s._v("\nBITCOUNT permission:menu:101\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5. 统计同时拥有菜单101和菜单102权限的用户数（交集）")]),s._v("\nBITOP AND permission:menu:101_102 permission:menu:101 permission:menu:102\nBITCOUNT permission:menu:101_102\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h3",{attrs:{id:"_3-4-布隆过滤器-bloom-filter-底层实现"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-布隆过滤器-bloom-filter-底层实现"}},[s._v("#")]),s._v(" 3.4 布隆过滤器（Bloom Filter）底层实现")]),s._v(" "),t("h4",{attrs:{id:"_3-4-1-场景需求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-1-场景需求"}},[s._v("#")]),s._v(" 3.4.1 场景需求")]),s._v(" "),t("p",[s._v("快速判断一个元素是否存在于海量数据集合中（如判断用户是否为新用户、判断URL是否已爬取、判断订单号是否存在），允许一定的误判率，但要求极高的查询效率和空间效率。")]),s._v(" "),t("h4",{attrs:{id:"_3-4-2-实现方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-2-实现方案"}},[s._v("#")]),s._v(" 3.4.2 实现方案")]),s._v(" "),t("p",[s._v("布隆过滤器的核心是多个哈希函数 + Bitmap：")]),s._v(" "),t("ul",[t("li",[s._v("将元素通过多个哈希函数计算得到多个整数偏移量。")]),s._v(" "),t("li",[s._v("将Bitmap中这些偏移量对应的bit位设置为1。")]),s._v(" "),t("li",[s._v("查询时，若所有偏移量对应的bit位均为1，则元素“可能存在”；若有一个为0，则元素“一定不存在”。")])]),s._v(" "),t("h4",{attrs:{id:"_3-4-3-基于redis-bitmap的实现示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-3-基于redis-bitmap的实现示例"}},[s._v("#")]),s._v(" 3.4.3 基于Redis Bitmap的实现示例")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" hashlib\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hash_functions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("element"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" num_hashes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" bitmap_length"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""生成num_hashes个哈希偏移量"""')]),s._v("\n    offsets "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("range")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("num_hashes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 结合i生成不同的哈希值")]),s._v("\n        hash_val "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hashlib"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("md5"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string-interpolation"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('f"')]),t("span",{pre:!0,attrs:{class:"token interpolation"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("element"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token interpolation"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("encode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hexdigest"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 转换为整数偏移量，取模bitmap_length确保在范围内")]),s._v("\n        offset "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hash_val"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" bitmap_length\n        offsets"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("append"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("offset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" offsets\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 初始化布隆过滤器（Bitmap长度为1000000bit，3个哈希函数）")]),s._v("\nBITMAP_KEY "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bloom:filter"')]),s._v("\nBITMAP_LENGTH "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000000")]),s._v("\nNUM_HASHES "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 向布隆过滤器中添加元素（如用户ID：user_123456）")]),s._v("\nelement "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user_123456"')]),s._v("\noffsets "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hash_functions"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("element"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" NUM_HASHES"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" BITMAP_LENGTH"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" offset "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" offsets"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    redis_client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("setbit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("BITMAP_KEY"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" offset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 查询元素是否存在")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("is_exist")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("element"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    offsets "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hash_functions"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("element"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" NUM_HASHES"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" BITMAP_LENGTH"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" offset "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" offsets"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" redis_client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("getbit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("BITMAP_KEY"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" offset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("False")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一定不存在")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可能存在")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("is_exist"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user_123456"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# True（可能存在）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("is_exist"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user_654321"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# False（一定不存在）")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br")])]),t("p",[s._v("优势：相比传统的集合（Set），布隆过滤器的空间效率极高（存储100万元素，误判率1%，仅需约1.2MB空间），查询时间复杂度为O(k)（k为哈希函数个数，通常为3-8）。")]),s._v(" "),t("h2",{attrs:{id:"四、实现原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#四、实现原理"}},[s._v("#")]),s._v(" 四、实现原理")]),s._v(" "),t("h3",{attrs:{id:"_4-1-底层存储-基于string的二进制安全特性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-底层存储-基于string的二进制安全特性"}},[s._v("#")]),s._v(" 4.1 底层存储：基于String的二进制安全特性")]),s._v(" "),t("p",[s._v("Redis的String类型底层存储的是字节序列（char[]），每个字节占8个bit位。Bitmap本质上是对这个字节序列的bit位进行直接操作。例如，当执行SETBIT key 10 1时，Redis会进行以下计算：")]),s._v(" "),t("ol",[t("li",[s._v("计算字节索引：offset / 8 = 10 / 8 = 1（即第2个字节，索引从0开始）。")]),s._v(" "),t("li",[s._v("计算bit位在字节中的位置：offset % 8 = 10 % 8 = 2（即该字节的第3个bit位，从0开始）。")]),s._v(" "),t("li",[s._v("读取该字节的原始值，通过位运算（OR）将对应bit位设为1，再写回字节序列。")])]),s._v(" "),t("p",[s._v("若offset对应的字节不存在（即超过当前String的长度），Redis会自动扩展字节序列，填充0，直到字节索引对应的位置存在。")]),s._v(" "),t("h3",{attrs:{id:"_4-2-高效性保障-位运算的底层优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-高效性保障-位运算的底层优化"}},[s._v("#")]),s._v(" 4.2 高效性保障：位运算的底层优化")]),s._v(" "),t("p",[s._v("Redis对位图操作的高效性，源于底层对CPU位运算指令的直接利用：")]),s._v(" "),t("ul",[t("li",[s._v("SETBIT/GETBIT：单个bit位的操作仅需一次字节读取+位运算+字节写入，时间复杂度O(1)。")]),s._v(" "),t("li",[s._v("BITCOUNT：采用了“查表法”优化。Redis预定义了一个256元素的数组，存储0-255每个整数的bit 1的个数（如0的个数为0，1的个数为1，2的个数为1，...，255的个数为8）。统计时，将Bitmap的每个字节作为索引查询数组，累加结果，时间复杂度O(n)（n为字节数），效率远高于逐bit位统计。")]),s._v(" "),t("li",[s._v("BITOP：直接调用CPU的位运算指令（AND/OR/XOR/NOT），对多个字节序列进行并行运算，时间复杂度O(n)（n为最长字节序列的长度）。")])]),s._v(" "),t("h3",{attrs:{id:"_4-3-内存占用计算"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-内存占用计算"}},[s._v("#")]),s._v(" 4.3 内存占用计算")]),s._v(" "),t("p",[s._v("Bitmap的内存占用仅与最大偏移量有关，公式为：\n内存占用（字节）= ceil(max_offset / 8)")]),s._v(" "),t("p",[s._v("例如：")]),s._v(" "),t("ul",[t("li",[s._v("最大偏移量为100（用户ID 100）：ceil(100/8) = 13字节。")]),s._v(" "),t("li",[s._v("最大偏移量为1000万：ceil(10000000/8) = 1250000字节 ≈ 1.2MB。")]),s._v(" "),t("li",[s._v("最大偏移量为1亿：ceil(100000000/8) = 12500000字节 ≈ 12.5MB。")])]),s._v(" "),t("p",[s._v("注意：若偏移量跳跃极大（如仅设置offset=10000000的bit位），Redis仍会占用1.2MB空间（即使其他bit位均为0），因为需要填充到最大偏移量对应的字节。因此，使用时应尽量保证偏移量连续或集中在较小范围内。")]),s._v(" "),t("h2",{attrs:{id:"五、注意事项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#五、注意事项"}},[s._v("#")]),s._v(" 五、注意事项")]),s._v(" "),t("h3",{attrs:{id:"_5-1-偏移量的合理设计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-偏移量的合理设计"}},[s._v("#")]),s._v(" 5.1 偏移量的合理设计")]),s._v(" "),t("ul",[t("li",[s._v("避免过大的偏移量：若偏移量达到10亿，内存占用将达到125MB（10亿/8 = 125,000,000字节），若多个此类Bitmap并存，会占用大量内存。")]),s._v(" "),t("li",[s._v("偏移量映射：若数据标识为非整数（如用户名、UUID），需先建立映射表（如username_to_id），将非整数标识转换为连续的整数偏移量，否则无法发挥Bitmap的空间优势。")])]),s._v(" "),t("h3",{attrs:{id:"_5-2-键的生命周期管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-键的生命周期管理"}},[s._v("#")]),s._v(" 5.2 键的生命周期管理")]),s._v(" "),t("p",[s._v("Bitmap基于String类型，若不主动设置过期时间，会永久占用内存。对于时效性数据（如每日签到、实时在线状态），应通过EXPIRE命令设置合理的过期时间，避免内存泄漏。例如：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置签到记录7天后过期（自动清理）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" EXPIRE sign:20260113 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("604800")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 604800秒 = 7天")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"_5-3-并发操作的安全性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-并发操作的安全性"}},[s._v("#")]),s._v(" 5.3 并发操作的安全性")]),s._v(" "),t("p",[s._v("SETBIT命令是原子操作（Redis所有单键命令均为原子操作），无需担心并发修改冲突。例如，多个客户端同时对同一个offset执行SETBIT，Redis会保证操作的顺序性和原子性，最终结果正确。")]),s._v(" "),t("p",[s._v("但需注意：若业务逻辑需要“先查询再修改”（如先GETBIT判断状态，再SETBIT修改），则存在并发竞争问题，需通过Redis事务（MULTI/EXEC）或分布式锁保证原子性。例如：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 确保用户只能签到一次（先查后改，需事务）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" MULTI\nOK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" GETBIT sign:20260113 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\nQUEUED\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" SETBIT sign:20260113 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nQUEUED\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" EXEC\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 之前未签到")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置成功")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 若之前已签到，GETBIT返回1，SETBIT仍会执行，但不影响结果（可在业务层判断是否需要执行SETBIT）")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h3",{attrs:{id:"_5-4-误判率问题-布隆过滤器场景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-误判率问题-布隆过滤器场景"}},[s._v("#")]),s._v(" 5.4 误判率问题（布隆过滤器场景）")]),s._v(" "),t("p",[s._v("基于Bitmap的布隆过滤器存在一定的误判率（即不存在的元素可能被判断为存在），误判率与Bitmap长度、哈希函数个数相关：")]),s._v(" "),t("ul",[t("li",[s._v("Bitmap长度越长，误判率越低。")]),s._v(" "),t("li",[s._v("哈希函数个数越多，误判率越低，但查询效率会略有下降。")])]),s._v(" "),t("p",[s._v("实际使用时，需根据业务允许的误判率（如1%、0.1%），通过公式计算合理的Bitmap长度和哈希函数个数，避免误判率过高影响业务。")]),s._v(" "),t("h3",{attrs:{id:"_5-5-不适合的场景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-不适合的场景"}},[s._v("#")]),s._v(" 5.5 不适合的场景")]),s._v(" "),t("ul",[t("li",[s._v("非布尔型数据存储：Bitmap仅能存储0/1，无法存储其他类型数据（如数值、字符串）。")]),s._v(" "),t("li",[s._v("非整数标识的数据：若数据标识无法转换为连续整数（如随机字符串），会导致偏移量过大，内存占用激增。")]),s._v(" "),t("li",[s._v("频繁更新和删除的场景：虽然SETBIT是原子操作，但Bitmap的删除（如删除某个用户的所有签到记录）需要遍历所有相关的Bitmap，效率较低（需通过键的过期时间间接清理）。")])]),s._v(" "),t("h2",{attrs:{id:"六、总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#六、总结"}},[s._v("#")]),s._v(" 六、总结")]),s._v(" "),t("p",[s._v("Redis Bitmap是一种基于String类型的轻量级、高效数据结构，核心优势是极高的空间效率和高效的位运算能力。它通过将布尔型数据存储在bit位中，大幅降低了内存占用，同时支持SETBIT、GETBIT、BITCOUNT、BITOP等命令，满足签到统计、在线状态、权限控制、布隆过滤器等多种场景的需求。")]),s._v(" "),t("p",[s._v("使用Bitmap时，需注意合理设计偏移量、管理键的生命周期、规避并发问题，同时明确其适用场景（布尔型数据、整数标识），避免在不适合的场景中强行使用。在海量布尔型数据存储和统计场景中，Bitmap是优于Hash、Set等结构的最优选择之一。")])])}),[],!1,null,null,null);t.default=e.exports}}]);