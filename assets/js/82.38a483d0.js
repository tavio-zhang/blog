(window.webpackJsonp=window.webpackJsonp||[]).push([[82],{438:function(t,a,s){"use strict";s.r(a);var n=s(8),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"spring-cloud-gateway-底层原理深度解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#spring-cloud-gateway-底层原理深度解析"}},[t._v("#")]),t._v(" Spring Cloud Gateway 底层原理深度解析")]),t._v(" "),a("p",[t._v("在微服务架构中，网关作为流量的入口，承担着路由转发、负载均衡、权限校验、限流熔断等核心职责。Spring Cloud Gateway 作为 Spring Cloud 生态中的官方网关解决方案，替代了传统的 Zuul 网关，基于 Spring WebFlux 和 Netty 实现，具备异步非阻塞、高性能、高扩展性等优势。")]),t._v(" "),a("h2",{attrs:{id:"一、核心定位与技术选型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、核心定位与技术选型"}},[t._v("#")]),t._v(" 一、核心定位与技术选型")]),t._v(" "),a("h3",{attrs:{id:"_1-1-核心定位"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-核心定位"}},[t._v("#")]),t._v(" 1.1 核心定位")]),t._v(" "),a("p",[t._v("Spring Cloud Gateway 是一款基于异步非阻塞模型的网关，核心目标是为微服务架构提供统一的路由管理和流量控制能力。其核心价值在于：")]),t._v(" "),a("ul",[a("li",[t._v("统一入口：所有客户端请求通过网关进入微服务集群，简化客户端与服务端的交互；")]),t._v(" "),a("li",[t._v("路由转发：根据预设规则将请求转发至对应的微服务实例；")]),t._v(" "),a("li",[t._v("流量治理：提供限流、熔断、负载均衡等流量控制能力；")]),t._v(" "),a("li",[t._v("安全防护：集成认证授权、黑白名单、接口加密等安全机制；")]),t._v(" "),a("li",[t._v("监控运维：收集请求日志、指标统计，支持链路追踪。")])]),t._v(" "),a("h3",{attrs:{id:"_1-2-技术选型底层逻辑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-技术选型底层逻辑"}},[t._v("#")]),t._v(" 1.2 技术选型底层逻辑")]),t._v(" "),a("p",[t._v("Spring Cloud Gateway 选择 Spring WebFlux + Netty 作为底层技术栈，而非传统的 Servlet 模型，核心原因在于：")]),t._v(" "),a("ol",[a("li",[t._v("异步非阻塞优势：传统 Servlet 模型基于同步阻塞 IO，每个请求对应一个线程，在高并发场景下线程资源易耗尽，导致性能瓶颈；而 Netty 基于 NIO 模型，通过事件驱动和多路复用机制，单线程可处理大量并发连接，结合 Spring WebFlux 的响应式编程模型（Reactor），进一步提升高并发场景下的吞吐量和响应速度。")]),t._v(" "),a("li",[t._v("Spring 生态无缝集成：Spring WebFlux 是 Spring 官方推出的响应式 Web 框架，与 Spring 生态（如 Spring Boot、Spring Security、Spring Cloud 组件）深度融合，降低开发者的学习成本和集成成本。")]),t._v(" "),a("li",[t._v("灵活的扩展机制：WebFlux 的 HandlerMapping、WebFilter 等组件为 Gateway 的路由匹配、过滤器链等核心功能提供了天然的扩展支撑。")])]),t._v(" "),a("p",[t._v('核心技术栈关系：Spring Cloud Gateway 基于 Spring WebFlux 构建，而 Spring WebFlux 底层依赖 Netty 作为嵌入式服务器，三者形成 "Gateway → WebFlux → Netty" 的底层依赖链。')]),t._v(" "),a("h2",{attrs:{id:"二、核心架构与核心组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、核心架构与核心组件"}},[t._v("#")]),t._v(" 二、核心架构与核心组件")]),t._v(" "),a("p",[t._v('Spring Cloud Gateway 的核心架构围绕 "路由转发" 和 "过滤器链" 展开，核心组件包括 Route（路由）、Predicate（断言）、Filter（过滤器），三者共同构成了 Gateway 的核心工作模型：'),a("strong",[t._v("当请求满足 Predicate 条件时，将通过 Filter 链处理后转发至目标 URI（即 Route 定义的目标服务）")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"_2-1-核心组件详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-核心组件详解"}},[t._v("#")]),t._v(" 2.1 核心组件详解")]),t._v(" "),a("h4",{attrs:{id:"_2-1-1-route-路由"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-route-路由"}},[t._v("#")]),t._v(" 2.1.1 Route（路由）")]),t._v(" "),a("p",[t._v("Route 是 Gateway 中最基础的组件，代表一条完整的路由规则，包含以下核心属性：")]),t._v(" "),a("ul",[a("li",[t._v('id：路由唯一标识（如 "route-user-service"）；')]),t._v(" "),a("li",[t._v("uri：目标服务地址（可分为 lb:// 开头的微服务名称，代表通过负载均衡转发；或 http:// 开头的固定地址）；")]),t._v(" "),a("li",[t._v("predicates：路由断言集合，只有当所有断言都匹配成功时，该路由才会生效；")]),t._v(" "),a("li",[t._v("filters：路由过滤器集合，用于对请求和响应进行拦截和处理；")]),t._v(" "),a("li",[t._v("order：路由优先级，数值越小优先级越高（当多个路由都匹配请求时，优先选择优先级高的路由）。")])]),t._v(" "),a("p",[t._v("底层数据结构：Route 接口的默认实现为 RouteDefinitionRoute，其创建依赖于 RouteDefinition（路由定义），RouteDefinition 是路由规则的配置载体，包含上述所有属性的配置信息，Gateway 启动时会将 RouteDefinition 解析为 Route 实例并注册到路由注册表中。")]),t._v(" "),a("h4",{attrs:{id:"_2-1-2-predicate-断言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-predicate-断言"}},[t._v("#")]),t._v(" 2.1.2 Predicate（断言）")]),t._v(" "),a("p",[t._v('Predicate 本质是 "请求匹配规则"，用于判断当前请求是否符合路由的转发条件。其底层基于 Java 8 的 Predicate 函数式接口，输入参数为 ServerWebExchange（包含请求、响应、上下文等信息），返回值为 boolean（true 表示匹配成功，false 表示匹配失败）。')]),t._v(" "),a("p",[t._v("核心实现逻辑：")]),t._v(" "),a("ul",[a("li",[t._v("Gateway 内置了多种常用 Predicate，如路径匹配（Path）、方法匹配（Method）、参数匹配（Query）、请求头匹配（Header）、时间匹配（After/Before/Between）等；")]),t._v(" "),a("li",[t._v("每种内置 Predicate 都对应一个工厂类（如 PathRoutePredicateFactory、MethodRoutePredicateFactory），工厂类负责将配置参数（如 Path=/user/**）解析为 Predicate 实例；")]),t._v(" "),a("li",[t._v('多个 Predicate 之间为 "与" 关系，只有所有 Predicate 都匹配成功，路由才会生效。')])]),t._v(" "),a("p",[t._v("源码片段（Predicate 匹配核心逻辑）：")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 路由匹配核心方法，位于 RoutePredicateHandlerMapping 类")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("protected")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Mono")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHandlerInternal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServerWebExchange")]),t._v(" exchange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1. 构建包含请求信息的查找键")]),t._v("\n    exchange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAttributes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GATEWAY_HANDLER_MAPPER_ATTR")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSimpleName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2. 遍历所有路由，匹配符合条件的路由（所有 Predicate 都返回 true）")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("lookupRoute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exchange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("flatMap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("route "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 3. 匹配成功，将路由信息存入上下文")]),t._v("\n                exchange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAttributes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GATEWAY_ROUTE_ATTR")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" route"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Mono")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("just")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("route"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("switchIfEmpty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Mono")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("empty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Mono")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("lookupRoute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServerWebExchange")]),t._v(" exchange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 遍历路由注册表中的所有路由")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("routeLocator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getRoutes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("concatMap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("route "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 匹配当前路由的所有 Predicate")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Mono")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("just")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("route"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("filterWhen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("routePredicate "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 执行 Predicate 匹配逻辑")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" routePredicate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPredicate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apply")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exchange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 选择优先级最高的路由（order 最小）")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("route "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("logger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDebugEnabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    logger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("debug")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Route matched: "')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" route"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("validateRoute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("route"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" exchange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" route"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br")])]),a("h4",{attrs:{id:"_2-1-3-filter-过滤器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-3-filter-过滤器"}},[t._v("#")]),t._v(" 2.1.3 Filter（过滤器）")]),t._v(" "),a("p",[t._v("Filter 是 Gateway 实现请求拦截和处理的核心组件，用于在请求转发前/后对请求和响应进行加工（如修改请求头、添加参数、日志记录、权限校验、限流熔断等）。其底层基于 GatewayFilter 接口，核心方法为 filter(ServerWebExchange exchange, GatewayFilterChain chain)，通过 GatewayFilterChain 实现过滤器的链式调用。")]),t._v(" "),a("p",[t._v("Filter 分类及核心差异：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("分类")]),t._v(" "),a("th",[t._v("作用范围")]),t._v(" "),a("th",[t._v("核心特点")]),t._v(" "),a("th",[t._v("实现方式")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("GatewayFilter（路由过滤器）")]),t._v(" "),a("td",[t._v("仅作用于指定路由")]),t._v(" "),a("td",[t._v("与具体路由绑定，可通过配置指定生效的路由")]),t._v(" "),a("td",[t._v("内置工厂类（如 AddRequestHeaderGatewayFilterFactory）或自定义实现")])]),t._v(" "),a("tr",[a("td",[t._v("GlobalFilter（全局过滤器）")]),t._v(" "),a("td",[t._v("作用于所有路由")]),t._v(" "),a("td",[t._v("无需绑定路由，自动对所有请求生效，常用于全局日志、全局认证等")]),t._v(" "),a("td",[t._v("实现 GlobalFilter 接口并注册为 Bean")])])])]),t._v(" "),a("p",[t._v("过滤器执行顺序：")]),t._v(" "),a("ul",[a("li",[t._v("所有过滤器都通过 Ordered 接口或 @Order 注解指定 order 值，order 数值越小，执行优先级越高；")]),t._v(" "),a("li",[t._v('执行阶段分为 "前置处理" 和 "后置处理"：前置处理按 order 升序执行，后置处理按 order 降序执行；')]),t._v(" "),a("li",[t._v("GlobalFilter 和 GatewayFilter 会合并为一个过滤器链，统一按 order 排序执行。")])]),t._v(" "),a("h3",{attrs:{id:"_2-2-核心架构组件协同关系"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-核心架构组件协同关系"}},[t._v("#")]),t._v(" 2.2 核心架构组件协同关系")]),t._v(" "),a("p",[t._v('Spring Cloud Gateway 的核心架构组件可分为 "配置解析层"、"路由匹配层"、"过滤器链层"、"转发层"，各层协同工作完成请求处理：')]),t._v(" "),a("ol",[a("li",[t._v("配置解析层：负责加载路由配置（如 yml 配置、数据库配置），通过 RouteDefinitionLocator 解析为 RouteDefinition，再通过 RouteDefinitionRouteLocator 转换为 Route 实例；")]),t._v(" "),a("li",[t._v("路由匹配层：通过 RoutePredicateHandlerMapping 遍历 Route 实例，利用 Predicate 匹配请求，找到符合条件的 Route；")]),t._v(" "),a("li",[t._v("过滤器链层：通过 FilteringWebHandler 构建过滤器链（GlobalFilter + 对应 Route 的 GatewayFilter），按顺序执行前置处理；")]),t._v(" "),a("li",[t._v("转发层：通过 NettyRoutingFilter 或 LoadBalancerClientFilter 将请求转发至目标服务，获取响应后，执行过滤器链的后置处理，最终将响应返回给客户端。")])]),t._v(" "),a("h2",{attrs:{id:"三、请求处理全流程底层解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、请求处理全流程底层解析"}},[t._v("#")]),t._v(" 三、请求处理全流程底层解析")]),t._v(" "),a("p",[t._v('Spring Cloud Gateway 的请求处理流程基于 Spring WebFlux 的响应式模型，核心是 "事件驱动 + 链式调用"，整个流程可分为 7 个关键步骤，结合源码和逻辑逐一拆解：')]),t._v(" "),a("h3",{attrs:{id:"步骤-1-netty-接收请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤-1-netty-接收请求"}},[t._v("#")]),t._v(" 步骤 1：Netty 接收请求")]),t._v(" "),a("p",[t._v("Gateway 底层依赖 Netty 作为嵌入式服务器，默认监听 8080 端口。当客户端发送 HTTP 请求时，Netty 的 NioEventLoopGroup 线程池会接收请求，通过 ChannelPipeline 进行请求解码（如 HTTP 协议解码），最终将请求封装为 ServerHttpRequest 对象，并创建对应的 ServerWebExchange（请求上下文）。")]),t._v(" "),a("p",[t._v("核心点：Netty 的异步非阻塞特性在此体现，接收请求的线程不会阻塞等待响应，而是通过事件回调继续处理其他请求。")]),t._v(" "),a("h3",{attrs:{id:"步骤-2-请求进入-webflux-dispatcherhandler"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤-2-请求进入-webflux-dispatcherhandler"}},[t._v("#")]),t._v(" 步骤 2：请求进入 WebFlux DispatcherHandler")]),t._v(" "),a("p",[t._v("Netty 接收请求后，会将请求传递给 Spring WebFlux 的核心 DispatcherHandler（请求分发器）。DispatcherHandler 是 WebFlux 的入口组件，负责将请求分发给对应的 HandlerMapping（处理器映射器）。")]),t._v(" "),a("p",[t._v("源码片段（DispatcherHandler 核心逻辑）：")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Mono")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Void")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServerWebExchange")]),t._v(" exchange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 遍历所有 HandlerMapping，找到能处理当前请求的 Handler")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Flux")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fromIterable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("handlerMappings"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("concatMap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mapping "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" mapping"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHandler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exchange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("switchIfEmpty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Mono")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ResponseStatusException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpStatus")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NOT_FOUND")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"No matching handler"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 执行 Handler（即 Gateway 的过滤器链 + 转发逻辑）")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("flatMap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("handler "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("invokeHandler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exchange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" handler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 处理响应结果")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("flatMap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("result "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handleResult")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exchange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br")])]),a("h3",{attrs:{id:"步骤-3-routepredicatehandlermapping-匹配路由"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤-3-routepredicatehandlermapping-匹配路由"}},[t._v("#")]),t._v(" 步骤 3：RoutePredicateHandlerMapping 匹配路由")]),t._v(" "),a("p",[t._v("在 Gateway 中，核心的 HandlerMapping 是 RoutePredicateHandlerMapping，其作用是根据请求匹配对应的 Route，并将 Route 封装为 Handler（实际为 FilteringWebHandler）。")]),t._v(" "),a("p",[t._v("核心逻辑：")]),t._v(" "),a("ul",[a("li",[t._v("RoutePredicateHandlerMapping 调用 getHandlerInternal 方法（前文源码片段），遍历 RouteLocator 中的所有 Route；")]),t._v(" "),a("li",[t._v("对每个 Route 执行 Predicate 匹配逻辑，找到所有 Predicate 都匹配的 Route；")]),t._v(" "),a("li",[t._v("将匹配成功的 Route 存入 ServerWebExchange 的属性中，返回 FilteringWebHandler 作为当前请求的 Handler。")])]),t._v(" "),a("h3",{attrs:{id:"步骤-4-filteringwebhandler-构建并执行过滤器链"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤-4-filteringwebhandler-构建并执行过滤器链"}},[t._v("#")]),t._v(" 步骤 4：FilteringWebHandler 构建并执行过滤器链")]),t._v(" "),a("p",[t._v("FilteringWebHandler 是 Gateway 中过滤器链的核心处理器，其核心职责是构建过滤器链并执行前置处理逻辑。")]),t._v(" "),a("p",[t._v("核心流程：")]),t._v(" "),a("ol",[a("li",[t._v("获取当前 Route 对应的 GatewayFilter 集合；")]),t._v(" "),a("li",[t._v("获取容器中所有的 GlobalFilter 实例，将其转换为 GatewayFilter（通过 GlobalFilterAdapter 适配）；")]),t._v(" "),a("li",[t._v("合并所有 GatewayFilter，按 order 排序，构建成 GatewayFilterChain 过滤器链；")]),t._v(" "),a("li",[t._v("调用过滤器链的 filter 方法，按顺序执行所有过滤器的前置处理逻辑。")])]),t._v(" "),a("p",[t._v("源码片段（过滤器链构建与执行）：")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Mono")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Void")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServerWebExchange")]),t._v(" exchange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1. 获取当前路由对应的 GatewayFilter")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Route")]),t._v(" route "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" exchange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getRequiredAttribute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GATEWAY_ROUTE_ATTR")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GatewayFilter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" gatewayFilters "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" route"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getFilters")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2. 获取所有 GlobalFilter 并转换为 GatewayFilter")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GatewayFilter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" globalFilters "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("globalFilters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stream")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filter "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GlobalFilterAdapter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("collect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Collectors")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 3. 合并过滤器并排序（按 order 升序）")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GatewayFilter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" combined "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayList")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("globalFilters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    combined"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addAll")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gatewayFilters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    combined"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AnnotationAwareOrderComparator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("INSTANCE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 4. 构建过滤器链并执行")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GatewayFilterChain")]),t._v(" chain "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DefaultGatewayFilterChain")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("combined"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" chain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("filter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exchange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br")])]),a("h3",{attrs:{id:"步骤-5-路由转发-nettyroutingfilter-loadbalancerclientfilter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤-5-路由转发-nettyroutingfilter-loadbalancerclientfilter"}},[t._v("#")]),t._v(" 步骤 5：路由转发（NettyRoutingFilter/LoadBalancerClientFilter）")]),t._v(" "),a("p",[t._v("过滤器链的前置处理执行完成后，最终会通过核心转发过滤器将请求转发至目标服务。根据 Route 的 uri 类型，分为两种转发逻辑：")]),t._v(" "),a("h4",{attrs:{id:"_5-1-固定地址转发-uri-为-http-开头"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-固定地址转发-uri-为-http-开头"}},[t._v("#")]),t._v(" 5.1 固定地址转发（uri 为 http:// 开头）")]),t._v(" "),a("p",[t._v("由 NettyRoutingFilter 负责转发，核心逻辑：")]),t._v(" "),a("ul",[a("li",[t._v("从 ServerWebExchange 中获取目标 uri 和请求信息（方法、请求头、请求体等）；")]),t._v(" "),a("li",[t._v("通过 Netty 的 HttpClient 发送异步 HTTP 请求到目标地址；")]),t._v(" "),a("li",[t._v("接收目标服务的响应，将响应信息封装为 ServerHttpResponse，存入 ServerWebExchange。")])]),t._v(" "),a("h4",{attrs:{id:"_5-2-微服务负载均衡转发-uri-为-lb-开头"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-微服务负载均衡转发-uri-为-lb-开头"}},[t._v("#")]),t._v(" 5.2 微服务负载均衡转发（uri 为 lb:// 开头）")]),t._v(" "),a("p",[t._v("由 LoadBalancerClientFilter 负责转发，核心逻辑：")]),t._v(" "),a("ul",[a("li",[t._v("解析 lb:// 后的微服务名称（如 lb://user-service）；")]),t._v(" "),a("li",[t._v("通过 Spring Cloud LoadBalancer（或 Eureka/Consul 客户端）获取该微服务的可用实例列表；")]),t._v(" "),a("li",[t._v("根据负载均衡算法（默认轮询）选择一个实例，将 uri 替换为实例的实际地址（如 http://192.168.1.100:8081）；")]),t._v(" "),a("li",[t._v("调用 NettyRoutingFilter 完成最终的请求转发。")])]),t._v(" "),a("p",[t._v("核心点：负载均衡的底层依赖 Spring Cloud LoadBalancer 的 ReactorLoadBalancer 接口，通过异步方式获取服务实例，保证整个转发流程的非阻塞特性。")]),t._v(" "),a("h3",{attrs:{id:"步骤-6-过滤器链后置处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤-6-过滤器链后置处理"}},[t._v("#")]),t._v(" 步骤 6：过滤器链后置处理")]),t._v(" "),a("p",[t._v("目标服务的响应返回后，会反向执行过滤器链的后置处理逻辑（即按 order 降序执行）。后置处理通常用于响应加工（如修改响应头、添加响应参数）、日志记录（如记录响应时间）、资源清理等。")]),t._v(" "),a("p",[t._v("示例：自定义全局过滤器记录请求响应时间：")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Component")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ResponseTimeGlobalFilter")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GlobalFilter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Ordered")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Mono")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Void")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("filter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServerWebExchange")]),t._v(" exchange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GatewayFilterChain")]),t._v(" chain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 前置处理：记录请求开始时间")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" start "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("currentTimeMillis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 执行后续过滤器，获取响应完成后的回调")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" chain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("filter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exchange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("doFinally")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("signalType "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 后置处理：计算响应时间并记录日志")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" end "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("currentTimeMillis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"请求响应时间："')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("end "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ms"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getOrder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 优先级较高，确保最先执行前置处理，最后执行后置处理")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br")])]),a("h3",{attrs:{id:"步骤-7-netty-响应客户端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤-7-netty-响应客户端"}},[t._v("#")]),t._v(" 步骤 7：Netty 响应客户端")]),t._v(" "),a("p",[t._v("过滤器链后置处理完成后，ServerWebExchange 中的响应信息会被传递给 Netty，Netty 将响应编码后发送给客户端，完成整个请求-响应流程。")]),t._v(" "),a("h2",{attrs:{id:"四、关键特性底层实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、关键特性底层实现"}},[t._v("#")]),t._v(" 四、关键特性底层实现")]),t._v(" "),a("h3",{attrs:{id:"_4-1-限流机制-基于-redis-lua"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-限流机制-基于-redis-lua"}},[t._v("#")]),t._v(" 4.1 限流机制（基于 Redis + Lua）")]),t._v(" "),a("p",[t._v("Gateway 内置的限流功能基于 Redis 和 Lua 脚本实现，核心过滤器为 RequestRateLimiterGatewayFilterFactory，支持令牌桶算法和漏桶算法（默认令牌桶算法）。")]),t._v(" "),a("p",[t._v("底层实现逻辑：")]),t._v(" "),a("ol",[a("li",[t._v("配置限流规则（如每秒允许 10 个请求，即令牌桶填充速率为 10/s，桶容量为 10）；")]),t._v(" "),a("li",[t._v("请求到达时，执行 Lua 脚本向 Redis 发送限流检查请求；")]),t._v(" "),a("li",[t._v("Lua 脚本基于令牌桶算法判断是否允许请求通过：若允许，从桶中获取 1 个令牌，返回成功；若不允许，返回失败；")]),t._v(" "),a("li",[t._v("若限流检查失败，Gateway 直接返回 429 Too Many Requests 响应，不转发至目标服务。")])]),t._v(" "),a("p",[t._v("核心优势：Lua 脚本的原子性保证了高并发场景下限流规则的准确性，避免出现超限制流的情况；Redis 的高性能支撑了大量请求的限流检查。")]),t._v(" "),a("h3",{attrs:{id:"_4-2-熔断机制-基于-resilience4j"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-熔断机制-基于-resilience4j"}},[t._v("#")]),t._v(" 4.2 熔断机制（基于 Resilience4j）")]),t._v(" "),a("p",[t._v("Gateway 集成 Resilience4j 实现熔断功能（替代传统的 Hystrix），核心过滤器为 Resilience4jGatewayFilterFactory，支持熔断、降级、超时控制等特性。")]),t._v(" "),a("p",[t._v("底层实现逻辑：")]),t._v(" "),a("ol",[a("li",[t._v("配置熔断规则（如失败率阈值 50%、熔断时长 10s、最小请求数 10）；")]),t._v(" "),a("li",[t._v("请求转发时，通过 Resilience4j 的 CircuitBreaker 组件监控请求的成功/失败状态；")]),t._v(" "),a("li",[t._v("当失败率达到阈值时，CircuitBreaker 状态从 CLOSED 转为 OPEN，触发熔断，此时后续请求会直接被拦截，执行降级逻辑（如返回默认响应）；")]),t._v(" "),a("li",[t._v("熔断时长结束后，CircuitBreaker 状态转为 HALF_OPEN，允许少量请求尝试访问目标服务：若请求成功，状态转为 CLOSED，恢复正常转发；若仍失败，继续保持 OPEN 状态。")])]),t._v(" "),a("p",[t._v("核心点：Resilience4j 基于响应式编程模型实现，与 Gateway 的异步非阻塞架构完全适配，避免了传统 Hystrix 同步阻塞模型的性能问题。")]),t._v(" "),a("h3",{attrs:{id:"_4-3-动态路由"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-动态路由"}},[t._v("#")]),t._v(" 4.3 动态路由")]),t._v(" "),a("p",[t._v("Gateway 支持动态路由（无需重启网关即可更新路由规则），其底层核心是 RouteLocator 的动态刷新机制。")]),t._v(" "),a("p",[t._v("实现方式：")]),t._v(" "),a("ol",[a("li",[t._v("自定义 RouteDefinitionLocator，从数据库、配置中心（如 Nacos、Apollo）等动态数据源加载路由配置；")]),t._v(" "),a("li",[t._v("通过 ApplicationEventPublisher 发布 RouteRefreshEvent 事件；")]),t._v(" "),a("li",[t._v("RoutePredicateHandlerMapping 监听 RouteRefreshEvent 事件，触发路由缓存刷新，重新加载最新的 Route 实例；")]),t._v(" "),a("li",[t._v("后续请求会使用最新的路由规则进行匹配。")])]),t._v(" "),a("p",[t._v("核心优势：动态路由支持灰度发布、蓝绿部署等场景，提升了网关的灵活性和可运维性。")]),t._v(" "),a("h2",{attrs:{id:"五、核心优势与性能优化点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、核心优势与性能优化点"}},[t._v("#")]),t._v(" 五、核心优势与性能优化点")]),t._v(" "),a("h3",{attrs:{id:"_5-1-核心优势"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-核心优势"}},[t._v("#")]),t._v(" 5.1 核心优势")]),t._v(" "),a("ul",[a("li",[t._v("异步非阻塞：基于 Netty 和 WebFlux，高并发场景下吞吐量远高于传统 Zuul 网关；")]),t._v(" "),a("li",[t._v("Spring 生态集成：无缝对接 Spring Boot、Spring Security、Spring Cloud 组件（如 LoadBalancer、Resilience4j）；")]),t._v(" "),a("li",[t._v("灵活的扩展机制：支持自定义 Predicate、Filter、RouteLocator，满足多样化业务需求；")]),t._v(" "),a("li",[t._v("丰富的内置特性：内置限流、熔断、负载均衡、动态路由等核心功能，开箱即用。")])]),t._v(" "),a("h3",{attrs:{id:"_5-2-性能优化点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-性能优化点"}},[t._v("#")]),t._v(" 5.2 性能优化点")]),t._v(" "),a("ul",[a("li",[t._v("合理配置 Netty 线程池：调整 NioEventLoopGroup 的核心线程数（默认等于 CPU 核心数），根据业务场景优化；")]),t._v(" "),a("li",[t._v("减少过滤器数量：避免不必要的全局过滤器，路由过滤器按需绑定，减少链式调用开销；")]),t._v(" "),a("li",[t._v("启用连接池复用：配置 Netty 客户端连接池，避免频繁创建和销毁连接；")]),t._v(" "),a("li",[t._v("优化路由匹配：避免复杂的 Predicate 规则，优先使用路径匹配等高效规则；")]),t._v(" "),a("li",[t._v("启用响应压缩：配置 spring.cloud.gateway.compression.enabled=true，减少网络传输开销。")])]),t._v(" "),a("h2",{attrs:{id:"六、总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六、总结"}},[t._v("#")]),t._v(" 六、总结")]),t._v(" "),a("p",[t._v('Spring Cloud Gateway 的底层原理围绕 "异步非阻塞" 核心架构展开，基于 Spring WebFlux 和 Netty 构建，通过 Route、Predicate、Filter 三大核心组件实现路由转发和流量治理。其请求处理流程遵循 "Netty 接收请求 → WebFlux 分发 → 路由匹配 → 过滤器链执行 → 转发至目标服务 → 后置处理 → 响应客户端" 的完整链路，各环节通过响应式编程模型保证高并发场景下的性能。')])])}),[],!1,null,null,null);a.default=e.exports}}]);