(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{404:function(s,a,e){"use strict";e.r(a);var n=e(8),r=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("Kafka 作为一款高性能、高吞吐量的分布式消息队列，在实时数据管道、日志收集、事件驱动架构等场景中被广泛应用。其核心优势在于高吞吐、低延迟、可持久化、高容错等特性。")]),s._v(" "),a("h2",{attrs:{id:"一、kafka-核心概念与-zookeeper-的作用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、kafka-核心概念与-zookeeper-的作用"}},[s._v("#")]),s._v(" 一、Kafka 核心概念与 Zookeeper 的作用")]),s._v(" "),a("h3",{attrs:{id:"_1-1-核心概念速览"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-核心概念速览"}},[s._v("#")]),s._v(" 1.1 核心概念速览")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("Broker")]),s._v("：Kafka 集群中的服务器节点，负责存储消息和处理客户端请求。")]),s._v(" "),a("li",[a("strong",[s._v("Topic")]),s._v('：消息的分类容器，生产者向 Topic 发送消息，消费者从 Topic 读取消息（类似数据库的"表"）。')]),s._v(" "),a("li",[a("strong",[s._v("Partition")]),s._v("：Topic 的分区，每个 Topic 可分为多个分区，实现消息的并行存储与消费（提升吞吐量）。")]),s._v(" "),a("li",[a("strong",[s._v("Replica")]),s._v("：分区的副本，用于故障容错（副本数越多，可靠性越高，但存储成本也越高）。")]),s._v(" "),a("li",[a("strong",[s._v("Producer")]),s._v("：消息生产者，负责向 Topic 发送消息。")]),s._v(" "),a("li",[a("strong",[s._v("Consumer")]),s._v("：消息消费者，负责从 Topic 读取消息。")]),s._v(" "),a("li",[a("strong",[s._v("Consumer Group")]),s._v("：消费者组，多个消费者组成一个组，共同消费 Topic 数据（同组内消费者分工消费不同分区，避免重复消费）。")]),s._v(" "),a("li",[a("strong",[s._v("Offset")]),s._v('：消息在分区中的唯一序号，用于标记消费者的消费位置（类似"书签"）。')])]),s._v(" "),a("h3",{attrs:{id:"_1-2-为什么需要-zookeeper"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-为什么需要-zookeeper"}},[s._v("#")]),s._v(" 1.2 为什么需要 Zookeeper？")]),s._v(" "),a("p",[s._v("在 Kafka 2.8 版本之前，Zookeeper 是必选依赖，主要承担以下核心职责：")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("存储元数据")]),s._v("：包括 Topic 配置（分区数、副本数等）、Broker 节点信息、分区与 Broker 的映射关系等。")]),s._v(" "),a("li",[a("strong",[s._v("协调集群")]),s._v("：负责 Broker 节点的注册与发现、Leader 分区的选举（确保分区故障时自动切换）。")]),s._v(" "),a("li",[a("strong",[s._v("同步状态")]),s._v("：Topic 的创建、删除、修改等操作需通过 Zookeeper 同步到整个集群。")])]),s._v(" "),a("p",[s._v("（注：Kafka 2.8+ 版本引入了 KRaft 模式，可脱离 Zookeeper 独立运行，但目前主流生产环境仍多使用 Zookeeper 模式。）")]),s._v(" "),a("h2",{attrs:{id:"二、环境搭建-docker-compose-部署-zookeeper-与-kafka"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、环境搭建-docker-compose-部署-zookeeper-与-kafka"}},[s._v("#")]),s._v(" 二、环境搭建：Docker Compose 部署 Zookeeper 与 Kafka")]),s._v(" "),a("p",[s._v("使用 Docker Compose 可快速搭建本地 Kafka 环境，无需手动配置依赖。")]),s._v(" "),a("h3",{attrs:{id:"_2-1-配置文件-docker-compose-yml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-配置文件-docker-compose-yml"}},[s._v("#")]),s._v(" 2.1 配置文件（docker-compose.yml）")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('version: \'3.8\'\n\nservices:\n  # ZooKeeper 服务（Kafka 依赖）\n  zookeeper:\n    image: confluentinc/cp-zookeeper:7.5.0  # 稳定版本，与 Kafka 版本兼容\n    container_name: zookeeper\n    environment:\n      ZOOKEEPER_CLIENT_PORT: 2181  # 客户端连接端口（默认2181）\n      ZOOKEEPER_TICK_TIME: 2000    # 心跳间隔时间（毫秒，集群同步基础）\n    ports:\n      - "2181:2181"  # 宿主机端口映射，外部可访问 Zookeeper\n    volumes:\n      - ./zookeeper-data:/data  # 持久化 Zookeeper 数据（避免容器重启丢失）\n    networks:\n      - kafka-network  # 加入自定义网络，与 Kafka 通信\n\n  # Kafka 服务\n  kafka:\n    image: confluentinc/cp-kafka:7.5.0  # 与 Zookeeper 版本保持一致\n    container_name: kafka\n    user: root  # 避免容器内文件权限问题\n    depends_on:\n      - zookeeper  # 依赖 Zookeeper，确保其先启动\n    environment:\n      KAFKA_BROKER_ID: 1  # Broker 唯一标识（集群模式需为不同值）\n      # 连接 Zookeeper（Docker 内部通过服务名访问，无需 IP）\n      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181\n      # 监听配置：区分内部（容器间）和外部（宿主机）访问\n      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092,PLAINTEXT_HOST://0.0.0.0:29092\n      # 暴露给外部的访问地址（宿主机用 localhost，服务器用公网 IP）\n      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:9092,PLAINTEXT_HOST://localhost:29092\n      # 监听协议映射（需与 LISTENERS 一一对应）\n      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT\n      KAFKA_AUTO_CREATE_TOPICS_ENABLE: "true"  # 开发环境自动创建 Topic（生产环境建议关闭）\n      KAFKA_LOG_RETENTION_HOURS: 168  # 消息留存时间（默认7天，可按需调整）\n      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1  # 偏移量 Topic 的副本数（单机1即可）\n    ports:\n      - "9092:9092"   # Docker 内部通信端口（容器间调用用）\n      - "29092:29092" # 宿主机外部访问端口（本地代码/工具连接用）\n    volumes:\n      - ./kafka-data:/var/lib/kafka/data  # 持久化 Kafka 消息数据\n    networks:\n      - kafka-network\n\n# 自定义网络（隔离容器，避免端口冲突）\nnetworks:\n  kafka-network:\n    driver: bridge\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br")])]),a("h3",{attrs:{id:"_2-2-启动环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-启动环境"}},[s._v("#")]),s._v(" 2.2 启动环境")]),s._v(" "),a("p",[s._v("在配置文件目录执行以下命令启动服务：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker-compose up -d  # -d 表示后台运行\n\n// 验证服务是否启动成功：\ndocker ps  # 查看 zookeeper 和 kafka 容器是否处于运行状态\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"三、topic-管理-创建与查看"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、topic-管理-创建与查看"}},[s._v("#")]),s._v(" 三、Topic 管理：创建与查看")]),s._v(" "),a("p",[s._v("Topic 是消息的载体，生产消费前需先创建 Topic（或依赖自动创建）。")]),s._v(" "),a("h3",{attrs:{id:"_3-1-创建-topic"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-创建-topic"}},[s._v("#")]),s._v(" 3.1 创建 Topic")]),s._v(" "),a("p",[s._v("使用 Kafka 内置工具 "),a("code",[s._v("kafka-topics")]),s._v(" 创建 Topic：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("kafka-topics \\\n  --create \\\n  --bootstrap-server localhost:29092 \\  # 连接 Broker（本地用 29092 端口）\n  --topic test \\  # Topic 名称\n  --if-not-exists \\  # 若已存在则不报错（推荐添加）\n  --partitions 1 \\  # 分区数（测试用1，生产环境根据并发需求调整，如4、8）\n  --replication-factor 1  # 副本数（测试用1，生产环境建议≥2以保证高可用）\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[a("strong",[s._v("参数说明")]),s._v("：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("partitions")]),s._v("：分区数越多，并行处理能力越强，但会增加集群管理成本。")]),s._v(" "),a("li",[a("code",[s._v("replication-factor")]),s._v("：副本数越多，数据可靠性越高，但会占用更多存储空间。")])]),s._v(" "),a("h3",{attrs:{id:"_3-2-查看-topic-列表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-查看-topic-列表"}},[s._v("#")]),s._v(" 3.2 查看 Topic 列表")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("kafka-topics --list --bootstrap-server localhost:29092\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_3-3-查看-topic-详情"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-查看-topic-详情"}},[s._v("#")]),s._v(" 3.3 查看 Topic 详情")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("kafka-topics --describe --bootstrap-server localhost:29092 --topic test\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("输出内容包括分区数、副本分布、Leader 分区等信息，可用于验证 Topic 配置。")]),s._v(" "),a("h2",{attrs:{id:"四、命令行快速体验-生产与消费消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、命令行快速体验-生产与消费消息"}},[s._v("#")]),s._v(" 四、命令行快速体验：生产与消费消息")]),s._v(" "),a("p",[s._v("Kafka 提供了命令行工具，可快速测试 Topic 的生产消费功能。")]),s._v(" "),a("h3",{attrs:{id:"_4-1-发送消息-生产者"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-发送消息-生产者"}},[s._v("#")]),s._v(" 4.1 发送消息（生产者）")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("kafka-console-producer --broker-list localhost:29092 --topic test\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("执行后进入交互模式，输入任意内容并回车，即可向 "),a("code",[s._v("test")]),s._v(" Topic 发送消息。")]),s._v(" "),a("h3",{attrs:{id:"_4-2-接收消息-消费者"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-接收消息-消费者"}},[s._v("#")]),s._v(" 4.2 接收消息（消费者）")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("kafka-console-consumer --bootstrap-server localhost:29092 --topic test --from-beginning\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("--from-beginning")]),s._v("：表示从 Topic 最开始的消息开始消费（默认只消费启动后的新消息）。")])]),s._v(" "),a("p",[s._v("打开两个终端，分别执行生产者和消费者命令，即可实时看到消息传递效果。")]),s._v(" "),a("h2",{attrs:{id:"五、java-代码实现-生产与消费消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、java-代码实现-生产与消费消息"}},[s._v("#")]),s._v(" 五、Java 代码实现：生产与消费消息")]),s._v(" "),a("p",[s._v("实际开发中，需通过代码实现生产者和消费者。以下是基于 Kafka 客户端的实现示例。")]),s._v(" "),a("h3",{attrs:{id:"_5-1-依赖引入-maven"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-依赖引入-maven"}},[s._v("#")]),s._v(" 5.1 依赖引入（Maven）")]),s._v(" "),a("p",[s._v("在 "),a("code",[s._v("pom.xml")]),s._v(" 中添加 Kafka 客户端依赖：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("<dependency>\n    <groupId>org.apache.kafka</groupId>\n    <artifactId>kafka-clients</artifactId>\n    <version>3.5.1</version>  \x3c!-- 与 Kafka 服务版本兼容 --\x3e\n</dependency>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"_5-2-生产者实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-生产者实现"}},[s._v("#")]),s._v(" 5.2 生产者实现")]),s._v(" "),a("h4",{attrs:{id:"_5-2-1-同步发送消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-1-同步发送消息"}},[s._v("#")]),s._v(" 5.2.1 同步发送消息")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('  @Test\n  void testSyncSendMsg() throws ExecutionException, InterruptedException {\n      // 1. 配置生产者参数\n      Properties properties = new Properties();\n      // 连接 Broker 地址（外部访问用 29092 端口）\n      properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, "localhost:29092");\n      //  key 序列化器（将字符串转为字节数组，Kafka 传输的是字节）\n      properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\n      //  value 序列化器\n      properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\n\n      // 2. 创建生产者实例\n      KafkaProducer<String, String> producer = new KafkaProducer<>(properties);\n\n      // 3. 发送消息（同步发送：等待 Broker 响应）\n      for (int i = 0; i < 10; i++) {\n          // 构建消息：Topic 名称、key（用于分区路由）、value（消息内容）\n          ProducerRecord<String, String> record = new ProducerRecord<>("test", \n                                                                        String.valueOf(i),  // key\n                                                                        "Hello World " + i); // value\n          // 发送消息并等待结果（同步阻塞）\n          RecordMetadata metadata = producer.send(record).get();\n          // 打印发送结果\n          System.out.printf("发送成功：topic=%s, partition=%d, offset=%d%n",\n                            metadata.topic(), metadata.partition(), metadata.offset());\n      }\n\n      // 4. 关闭生产者（释放资源）\n      producer.close();\n  }\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("p",[a("strong",[s._v("关键参数说明")]),s._v("：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("BOOTSTRAP_SERVERS_CONFIG")]),s._v('：Broker 地址列表（多个用逗号分隔，如 "host1:9092,host2:9092"）。')]),s._v(" "),a("li",[s._v("序列化器：Kafka 消息在网络中以字节传输，需指定序列化器将对象转为字节（此处用字符串序列化器）。")])]),s._v(" "),a("h4",{attrs:{id:"_5-2-2-异步发送消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-2-异步发送消息"}},[s._v("#")]),s._v(" 5.2.2 异步发送消息")]),s._v(" "),a("p",[s._v("同步发送会阻塞等待响应，效率较低；异步发送通过回调函数处理结果，性能更优：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('@Test\nvoid testAsyncSendMsg() {\n    Properties properties = new Properties();\n    properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, "localhost:29092");\n    properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\n    properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\n\n    KafkaProducer<String, String> producer = new KafkaProducer<>(properties);\n\n    for (int i = 0; i < 10; i++) {\n        ProducerRecord<String, String> record = new ProducerRecord<>("test", \n                                                                     String.valueOf(i), \n                                                                     "Async Hello " + i);\n        // 异步发送：通过 Callback 回调处理结果\n        producer.send(record, new Callback() {\n            @Override\n            public void onCompletion(RecordMetadata metadata, Exception e) {\n                if (e == null) {\n                    // 发送成功\n                    System.out.printf("异步发送成功：topic=%s, offset=%d%n",\n                                     metadata.topic(), metadata.offset());\n                } else {\n                    // 发送失败\n                    System.err.println("发送失败：" + e.getMessage());\n                }\n            }\n        });\n    }\n\n    // 关闭前需等待异步回调完成（实际开发中可配合线程池或CountDownLatch）\n    producer.flush();  // 强制刷新缓冲区\n    producer.close();\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br")])]),a("h3",{attrs:{id:"_5-3-消费者实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-消费者实现"}},[s._v("#")]),s._v(" 5.3 消费者实现")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('  @Test\n  void testPullMsg() {\n      // 1. 配置消费者参数\n      Properties properties = new Properties();\n      properties.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, "localhost:29092");\n      // 消费者组 ID（必须指定，同组消费者分工消费分区）\n      properties.put(ConsumerConfig.GROUP_ID_CONFIG, "test-group");\n      // 自动提交 offset（开发环境简化配置，生产环境建议手动提交）\n      properties.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, "true");\n      // 自动提交 offset 的间隔（毫秒）\n      properties.put(ConsumerConfig.AUTO_COMMIT_INTERVAL_MS_CONFIG, "1000");\n      // key 反序列化器（将字节数组转为字符串）\n      properties.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());\n      // value 反序列化器\n      properties.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());\n      // 首次消费位置（earliest：从最早消息开始；latest：从最新消息开始）\n      properties.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, "earliest");\n\n      // 2. 创建消费者实例\n      KafkaConsumer<String, String> consumer = new KafkaConsumer<>(properties);\n\n      // 3. 订阅 Topic（可订阅多个，用列表传入）\n      consumer.subscribe(Arrays.asList("test"));\n\n      // 4. 循环拉取消息（Kafka 是"拉取式"消费）\n      while (true) {\n          // 拉取消息（超时时间：5秒内无消息则返回空）\n          ConsumerRecords<String, String> records = consumer.poll(Duration.ofSeconds(5));\n          \n          // 遍历处理消息\n          for (ConsumerRecord<String, String> record : records) {\n              System.out.printf("消费消息：topic=%s, partition=%d, offset=%d, key=%s, value=%s%n",\n                                record.topic(), record.partition(), record.offset(),\n                                record.key(), record.value());\n          }\n      }\n  }\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br")])]),a("p",[a("strong",[s._v("关键参数说明")]),s._v("：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("GROUP_ID_CONFIG")]),s._v("：消费者组 ID，同组内消费者共同消费 Topic，每个分区只能被组内一个消费者消费（避免重复消费）。")]),s._v(" "),a("li",[a("code",[s._v("AUTO_OFFSET_RESET_CONFIG")]),s._v("：当消费者组首次消费或 offset 无效时，指定从最早（earliest）还是最新（latest）消息开始消费。")]),s._v(" "),a("li",[a("code",[s._v("poll()")]),s._v(" 方法：消费者主动拉取消息的核心方法，参数为超时时间（避免无限阻塞）。")])]),s._v(" "),a("h2",{attrs:{id:"六、注意事项与最佳实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六、注意事项与最佳实践"}},[s._v("#")]),s._v(" 六、注意事项与最佳实践")]),s._v(" "),a("ol",[a("li",[a("p",[a("strong",[s._v("端口使用")]),s._v("：")]),s._v(" "),a("ul",[a("li",[s._v("容器间通信用 9092 端口（如其他容器连接 Kafka）。")]),s._v(" "),a("li",[s._v("宿主机或外部服务连接用 29092 端口。")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("Topic 设计")]),s._v("：")]),s._v(" "),a("ul",[a("li",[s._v("分区数：根据并发需求设置（建议与 Broker 核心数匹配），一旦创建无法减少（可增加）。")]),s._v(" "),a("li",[s._v("副本数：生产环境建议 ≥2，确保单 Broker 故障时数据不丢失。")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("消息可靠性")]),s._v("：")]),s._v(" "),a("ul",[a("li",[s._v("生产者：通过 "),a("code",[s._v("acks")]),s._v(" 参数控制可靠性（"),a("code",[s._v("acks=all")]),s._v(" 表示所有副本确认后才算发送成功，可靠性最高）。")]),s._v(" "),a("li",[s._v("消费者：生产环境建议关闭自动提交 offset，通过 "),a("code",[s._v("consumer.commitSync()")]),s._v(" 手动提交（避免消费失败后 offset 已提交）。")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("性能优化")]),s._v("：")]),s._v(" "),a("ul",[a("li",[s._v("生产者：启用批量发送（"),a("code",[s._v("batch.size")]),s._v("）、压缩消息（"),a("code",[s._v("compression.type=gzip")]),s._v("）。")]),s._v(" "),a("li",[s._v("消费者：合理设置 "),a("code",[s._v("fetch.min.bytes")]),s._v("（拉取最小字节数）和 "),a("code",[s._v("fetch.max.wait.ms")]),s._v("（最大等待时间），平衡延迟与吞吐量。")])])])])])}),[],!1,null,null,null);a.default=r.exports}}]);