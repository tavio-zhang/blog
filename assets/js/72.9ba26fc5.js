(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{427:function(s,n,a){"use strict";a.r(n);var e=a(8),t=Object(e.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("在高并发系统中，Redis 作为核心缓存组件，能显著降低数据库压力、提升响应速度。但不合理的缓存设计易引发 "),n("strong",[s._v("穿透、击穿、雪崩")]),s._v(" 三大典型问题，可能导致数据库宕机、系统雪崩。")]),s._v(" "),n("h2",{attrs:{id:"一、核心问题定义与本质区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、核心问题定义与本质区别"}},[s._v("#")]),s._v(" 一、核心问题定义与本质区别")]),s._v(" "),n("p",[s._v("三大问题均源于“缓存未命中”，但触发场景、影响范围截然不同，需精准区分：")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("问题类型")]),s._v(" "),n("th",[s._v("定义")]),s._v(" "),n("th",[s._v("本质")]),s._v(" "),n("th",[s._v("典型场景")]),s._v(" "),n("th",[s._v("影响程度")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("缓存穿透")]),s._v(" "),n("td",[s._v("频繁请求“不存在的数据”，缓存无数据，请求直达数据库")]),s._v(" "),n("td",[s._v("缓存对“无效key”无防护，形成“缓存真空”")]),s._v(" "),n("td",[s._v("恶意攻击（遍历不存在的ID）、业务误操作（查询非法参数）")]),s._v(" "),n("td",[s._v("中等（持续消耗DB资源）")])]),s._v(" "),n("tr",[n("td",[s._v("缓存击穿")]),s._v(" "),n("td",[s._v("热点key突然过期，瞬间大量并发请求未命中缓存，全部穿透到数据库")]),s._v(" "),n("td",[s._v("热点key“失效时间点”与“高并发请求”重叠，形成流量尖峰")]),s._v(" "),n("td",[s._v("秒杀商品缓存过期、热门文章缓存失效")]),s._v(" "),n("td",[s._v("高（瞬间压垮DB）")])]),s._v(" "),n("tr",[n("td",[s._v("缓存雪崩")]),s._v(" "),n("td",[s._v("大量key同时过期，或缓存服务宕机，导致所有请求穿透到数据库")]),s._v(" "),n("td",[s._v("缓存层整体失效，流量集中冲击数据库")]),s._v(" "),n("td",[s._v("整点批量设置缓存过期、Redis 单点故障宕机")]),s._v(" "),n("td",[s._v("致命（系统整体雪崩）")])])])]),s._v(" "),n("h2",{attrs:{id:"二、缓存穿透-无效请求的防护方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、缓存穿透-无效请求的防护方案"}},[s._v("#")]),s._v(" 二、缓存穿透：无效请求的防护方案")]),s._v(" "),n("p",[s._v("缓存穿透的核心是“无效key绕过缓存”，解决方案围绕“拦截无效请求”“填补缓存真空”展开，推荐三级防护体系，按需组合使用。")]),s._v(" "),n("h3",{attrs:{id:"_2-1-解决方案1-接口参数校验-第一道防线"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-解决方案1-接口参数校验-第一道防线"}},[s._v("#")]),s._v(" 2.1 解决方案1：接口参数校验（第一道防线）")]),s._v(" "),n("p",[n("strong",[s._v("核心原理")]),s._v("：在请求抵达缓存/数据库前，通过业务规则拦截非法参数，从源头阻断无效请求，成本最低、见效最快。")]),s._v(" "),n("h4",{attrs:{id:"实现要点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实现要点"}},[s._v("#")]),s._v(" 实现要点")]),s._v(" "),n("ul",[n("li",[s._v("校验参数合法性：如用户ID、商品ID需为正整数，避免 "),n("code",[s._v("-1")]),s._v("、"),n("code",[s._v("0")]),s._v("、字符串等非法值。")]),s._v(" "),n("li",[s._v("限制查询范围：如时间范围不能超过3个月，分页查询页码不超过1000页。")]),s._v(" "),n("li",[s._v("黑名单拦截：维护恶意请求黑名单（如频繁查询无效ID的IP），直接拒绝。")])]),s._v(" "),n("h4",{attrs:{id:"代码示例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代码示例"}},[s._v("#")]),s._v(" 代码示例")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('/**\n * 商品查询接口参数校验\n */\n@RestController\n@RequestMapping("/goods")\npublic class GoodsController {\n\n    @Autowired\n    private GoodsService goodsService;\n\n    @GetMapping("/{id}")\n    public Result<Goods> getGoods(@PathVariable Long id) {\n        // 1. 基础参数校验：拦截非法ID\n        if (id == null || id <= 0) {\n            return Result.fail("商品ID必须为正整数");\n        }\n        // 2. 范围校验：假设商品ID最大为100万\n        if (id > 1000000) {\n            return Result.fail("商品ID超出合法范围");\n        }\n        // 3. 后续执行缓存查询逻辑\n        return goodsService.getGoodsById(id);\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("h3",{attrs:{id:"_2-2-解决方案2-缓存空值-简单有效-中小场景首选"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-解决方案2-缓存空值-简单有效-中小场景首选"}},[s._v("#")]),s._v(" 2.2 解决方案2：缓存空值（简单有效，中小场景首选）")]),s._v(" "),n("p",[n("strong",[s._v("核心原理")]),s._v("：当数据库返回空结果时，在Redis中缓存“空值标记”并设置短期过期时间。后续请求会命中空值缓存，不再访问数据库，快速拦截无效请求。")]),s._v(" "),n("h4",{attrs:{id:"实现要点-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实现要点-2"}},[s._v("#")]),s._v(" 实现要点")]),s._v(" "),n("ul",[n("li",[s._v("空值需设置短期过期时间（5~10分钟）：避免真实数据新增后，缓存空值导致查询不到（数据一致性兜底）。")]),s._v(" "),n("li",[s._v("自定义"),n("code",[s._v("NullValue")]),s._v("标记类：避免与Redis默认不存储"),n("code",[s._v("null")]),s._v("的特性冲突，同时区分“真实空数据”和“缓存空标记”。")]),s._v(" "),n("li",[s._v("结合参数校验使用：减少无效空值缓存的存储压力。")])]),s._v(" "),n("h4",{attrs:{id:"代码示例-java-redistemplate"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代码示例-java-redistemplate"}},[s._v("#")]),s._v(" 代码示例（Java + RedisTemplate）")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('@Service\npublic class GoodsService {\n\n    @Autowired\n    private RedisTemplate<String, Object> redisTemplate;\n    @Autowired\n    private GoodsMapper goodsMapper;\n\n    // 空值缓存过期时间：5分钟\n    private static final long NULL_CACHE_EXPIRE = 5;\n    // 正常数据缓存过期时间：30分钟\n    private static final long NORMAL_CACHE_EXPIRE = 30;\n\n    public Goods getGoodsById(Long id) {\n        String cacheKey = "goods:id:" + id;\n\n        // 1. 先查缓存\n        Object cacheValue = redisTemplate.opsForValue().get(cacheKey);\n        if (cacheValue != null) {\n            // 命中空值标记，直接返回null\n            if (cacheValue instanceof NullValue) {\n                return null;\n            }\n            // 命中正常数据，直接返回\n            return (Goods) cacheValue;\n        }\n\n        // 2. 缓存未命中，查询数据库\n        Goods goods = goodsMapper.selectById(id);\n        if (goods == null) {\n            // 3. 数据库无数据：缓存空值标记\n            redisTemplate.opsForValue().set(\n                cacheKey, \n                new NullValue(), \n                NULL_CACHE_EXPIRE, \n                TimeUnit.MINUTES\n            );\n            return null;\n        }\n\n        // 4. 数据库有数据：缓存真实值\n        redisTemplate.opsForValue().set(\n            cacheKey, \n            goods, \n            NORMAL_CACHE_EXPIRE, \n            TimeUnit.MINUTES\n        );\n        return goods;\n    }\n\n    // 自定义空值标记类（需序列化）\n    public static class NullValue implements Serializable {\n        private static final long serialVersionUID = 1L;\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br")])]),n("h3",{attrs:{id:"_2-3-解决方案3-布隆过滤器-大数据量-高并发场景首选"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-解决方案3-布隆过滤器-大数据量-高并发场景首选"}},[s._v("#")]),s._v(" 2.3 解决方案3：布隆过滤器（大数据量/高并发场景首选）")]),s._v(" "),n("p",[n("strong",[s._v("核心原理")]),s._v("：布隆过滤器是概率性数据结构，通过“位数组+多个哈希函数”快速判断“元素是否可能存在于集合中”。不存在则直接返回，存在则走正常缓存流程，从根源拦截无效key。")]),s._v(" "),n("h4",{attrs:{id:"核心特性"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#核心特性"}},[s._v("#")]),s._v(" 核心特性")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("优点")]),s._v(" "),n("th",[s._v("缺点")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("空间利用率极高（以bit为单位存储）")]),s._v(" "),n("td",[s._v("存在误判率（无法完全避免穿透，需兜底）")])]),s._v(" "),n("tr",[n("td",[s._v("查询速度快（O(k)，k为哈希函数数量）")]),s._v(" "),n("td",[s._v("不支持删除数据（需定期重建）")])]),s._v(" "),n("tr",[n("td",[s._v("支持海量数据（百万级元素仅需几MB内存）")]),s._v(" "),n("td",[s._v("需提前初始化合法数据集合")])])])]),s._v(" "),n("h4",{attrs:{id:"实现方式-redisbloom模块-生产环境推荐"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实现方式-redisbloom模块-生产环境推荐"}},[s._v("#")]),s._v(" 实现方式：RedisBloom模块（生产环境推荐）")]),s._v(" "),n("p",[s._v("RedisBloom是Redis的官方扩展模块，原生支持布隆过滤器，无需手动实现复杂逻辑。")]),s._v(" "),n("h5",{attrs:{id:"步骤1-安装redisbloom模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#步骤1-安装redisbloom模块"}},[s._v("#")]),s._v(" 步骤1：安装RedisBloom模块")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 1. 下载RedisBloom模块（GitHub：https://github.com/RedisBloom/RedisBloom）\n# 2. 启动Redis时加载模块\nredis-server --loadmodule /path/to/redisbloom.so\n# 或在redis.conf中配置（永久生效）\nloadmodule /path/to/redisbloom.so\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h5",{attrs:{id:"步骤2-核心代码实现-java"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#步骤2-核心代码实现-java"}},[s._v("#")]),s._v(" 步骤2：核心代码实现（Java）")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('@Service\npublic class BloomFilterService {\n\n    @Autowired\n    private StringRedisTemplate redisTemplate;\n\n    // 布隆过滤器名称（存储所有合法商品ID）\n    private static final String BLOOM_FILTER_KEY = "bloom:filter:goods_ids";\n    // 预期元素数量（100万）\n    private static final long EXPECTED_SIZE = 1000000;\n    // 误判率（1%，根据业务调整）\n    private static final double FALSE_POSITIVE_RATE = 0.01;\n\n    // 初始化布隆过滤器（系统启动时执行）\n    @PostConstruct\n    public void initBloomFilter() {\n        // 检查过滤器是否已存在，不存在则创建\n        Boolean exists = redisTemplate.hasKey(BLOOM_FILTER_KEY);\n        if (Boolean.FALSE.equals(exists)) {\n            // 执行bf.reserve命令：创建布隆过滤器\n            redisTemplate.execute(\n                new DefaultRedisScript<>(\n                    "return bf.reserve(KEYS[1], ARGV[1], ARGV[2])",\n                    String.class\n                ),\n                Collections.singletonList(BLOOM_FILTER_KEY),\n                String.valueOf(FALSE_POSITIVE_RATE),\n                String.valueOf(EXPECTED_SIZE)\n            );\n            // 批量添加合法商品ID（从数据库查询所有有效ID）\n            List<Long> validGoodsIds = goodsMapper.selectAllValidIds();\n            for (Long id : validGoodsIds) {\n                addToBloomFilter(id.toString());\n            }\n            log.info("布隆过滤器初始化完成，加载合法商品ID {} 个", validGoodsIds.size());\n        }\n    }\n\n    // 新增商品时，同步添加到布隆过滤器\n    public void addToBloomFilter(String value) {\n        redisTemplate.execute(\n            new DefaultRedisScript<>("return bf.add(KEYS[1], ARGV[1])", Long.class),\n            Collections.singletonList(BLOOM_FILTER_KEY),\n            value\n        );\n    }\n\n    // 判断元素是否可能存在（存在返回true，不存在返回false）\n    public boolean mightContain(String value) {\n        Long result = redisTemplate.execute(\n            new DefaultRedisScript<>("return bf.exists(KEYS[1], ARGV[1])", Long.class),\n            Collections.singletonList(BLOOM_FILTER_KEY),\n            value\n        );\n        return result != null && result == 1;\n    }\n}\n\n// 业务层整合布隆过滤器\n@Service\npublic class GoodsService {\n\n    @Autowired\n    private BloomFilterService bloomFilterService;\n\n    public Goods getGoodsById(Long id) {\n        String cacheKey = "goods:id:" + id;\n        String bloomValue = id.toString();\n\n        // 1. 布隆过滤器拦截：不存在则直接返回（第一道拦截）\n        if (!bloomFilterService.mightContain(bloomValue)) {\n            log.info("布隆过滤器拦截无效商品ID：{}", id);\n            return null;\n        }\n\n        // 2. 查询缓存（第二道拦截，处理布隆误判）\n        Object cacheValue = redisTemplate.opsForValue().get(cacheKey);\n        if (cacheValue != null) {\n            return cacheValue instanceof NullValue ? null : (Goods) cacheValue;\n        }\n\n        // 3. 查询数据库并缓存结果（省略，同缓存空值方案）\n        return queryDbAndCacheResult(id, cacheKey);\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br")])]),n("h5",{attrs:{id:"误判率与内存占用参考"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#误判率与内存占用参考"}},[s._v("#")]),s._v(" 误判率与内存占用参考")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("预期元素数量")]),s._v(" "),n("th",[s._v("误判率")]),s._v(" "),n("th",[s._v("内存占用（约）")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("10万")]),s._v(" "),n("td",[s._v("0.01%")]),s._v(" "),n("td",[s._v("190KB")])]),s._v(" "),n("tr",[n("td",[s._v("100万")]),s._v(" "),n("td",[s._v("0.01%")]),s._v(" "),n("td",[s._v("1.8MB")])]),s._v(" "),n("tr",[n("td",[s._v("1000万")]),s._v(" "),n("td",[s._v("0.01%")]),s._v(" "),n("td",[s._v("18MB")])]),s._v(" "),n("tr",[n("td",[s._v("1000万")]),s._v(" "),n("td",[s._v("1%")]),s._v(" "),n("td",[s._v("12MB")])])])]),s._v(" "),n("h3",{attrs:{id:"_2-4-缓存穿透方案组合建议"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-缓存穿透方案组合建议"}},[s._v("#")]),s._v(" 2.4 缓存穿透方案组合建议")]),s._v(" "),n("ul",[n("li",[s._v("中小场景：接口参数校验 + 缓存空值（低成本、易实现）。")]),s._v(" "),n("li",[s._v("大数据量/高并发场景：接口参数校验 + 布隆过滤器 + 缓存空值（三重防护，零穿透）。")])]),s._v(" "),n("h2",{attrs:{id:"三、缓存击穿-热点key的防护方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三、缓存击穿-热点key的防护方案"}},[s._v("#")]),s._v(" 三、缓存击穿：热点key的防护方案")]),s._v(" "),n("p",[s._v("缓存击穿的核心是“热点key失效瞬间的并发冲击”，解决方案围绕“避免热点key失效”“控制并发查询”展开，优先保证高可用和用户体验。")]),s._v(" "),n("h3",{attrs:{id:"_3-1-解决方案1-互斥锁-通用场景首选"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-解决方案1-互斥锁-通用场景首选"}},[s._v("#")]),s._v(" 3.1 解决方案1：互斥锁（通用场景首选）")]),s._v(" "),n("p",[n("strong",[s._v("核心原理")]),s._v("：缓存失效时，仅允许一个线程获取锁查询数据库并更新缓存，其他线程等待重试，避免大量并发请求直接打数据库。")]),s._v(" "),n("h4",{attrs:{id:"实现要点-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实现要点-3"}},[s._v("#")]),s._v(" 实现要点")]),s._v(" "),n("ul",[n("li",[s._v("锁粒度：按热点key维度加锁（如"),n("code",[s._v("lock:goods:1001")]),s._v("），避免全局锁降低并发。")]),s._v(" "),n("li",[s._v("锁过期时间：需大于“数据库查询+缓存更新”的总耗时（推荐3~5秒），避免锁提前释放导致并发问题。")]),s._v(" "),n("li",[s._v("重试策略：非阻塞重试（最多5次，间隔100~200ms），避免线程长期阻塞。")]),s._v(" "),n("li",[s._v("锁释放：必须在"),n("code",[s._v("finally")]),s._v("块中释放，且仅释放当前线程持有的锁。")])]),s._v(" "),n("h4",{attrs:{id:"代码示例-java-redisson"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代码示例-java-redisson"}},[s._v("#")]),s._v(" 代码示例（Java + Redisson）")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('@Service\npublic class GoodsService {\n\n    @Autowired\n    private RedisTemplate<String, Object> redisTemplate;\n    @Autowired\n    private GoodsMapper goodsMapper;\n    @Autowired\n    private RedissonClient redissonClient;\n\n    // 锁前缀（按key维度加锁）\n    private static final String LOCK_PREFIX = "lock:goods:";\n    // 缓存过期时间（30分钟）\n    private static final long CACHE_EXPIRE = 30;\n    // 锁过期时间（3秒，需大于DB查询+缓存更新耗时）\n    private static final long LOCK_EXPIRE = 3;\n    // 最大重试次数\n    private static final int MAX_RETRY = 5;\n    // 重试间隔（100ms）\n    private static final long RETRY_INTERVAL = 100;\n\n    public Goods getGoodsById(Long id) {\n        String cacheKey = "goods:id:" + id;\n        String lockKey = LOCK_PREFIX + id;\n\n        // 1. 先查缓存：命中直接返回\n        Goods goods = (Goods) redisTemplate.opsForValue().get(cacheKey);\n        if (goods != null) {\n            return goods;\n        }\n\n        // 2. 缓存失效，获取互斥锁\n        RLock lock = redissonClient.getLock(lockKey);\n        try {\n            // 尝试获取锁：非阻塞（最多等待0秒），锁3秒后自动释放\n            boolean locked = lock.tryLock(0, LOCK_EXPIRE, TimeUnit.SECONDS);\n            if (locked) {\n                // 3. 获锁成功：查询数据库（双重检查缓存，避免锁等待期间缓存已更新）\n                goods = (Goods) redisTemplate.opsForValue().get(cacheKey);\n                if (goods != null) {\n                    return goods;\n                }\n                // 数据库查询\n                goods = goodsMapper.selectById(id);\n                if (goods == null) {\n                    // 数据库无数据：缓存空值（5分钟）\n                    redisTemplate.opsForValue().set(\n                        cacheKey, \n                        new NullValue(), \n                        5, \n                        TimeUnit.MINUTES\n                    );\n                    return null;\n                }\n                // 数据库有数据：更新缓存\n                redisTemplate.opsForValue().set(\n                    cacheKey, \n                    goods, \n                    CACHE_EXPIRE, \n                    TimeUnit.MINUTES\n                );\n                return goods;\n            } else {\n                // 4. 获锁失败：重试（最多5次）\n                int retryCount = 0;\n                while (retryCount < MAX_RETRY) {\n                    Thread.sleep(RETRY_INTERVAL);\n                    goods = (Goods) redisTemplate.opsForValue().get(cacheKey);\n                    if (goods != null) {\n                        return goods;\n                    }\n                    retryCount++;\n                }\n                // 重试失败：返回兜底数据（保证用户体验）\n                return buildFallbackGoods(id);\n            }\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n            return buildFallbackGoods(id);\n        } finally {\n            // 5. 释放锁（仅释放当前线程持有的锁）\n            if (lock.isHeldByCurrentThread()) {\n                lock.unlock();\n            }\n        }\n    }\n\n    // 构建兜底数据\n    private Goods buildFallbackGoods(Long id) {\n        Goods fallback = new Goods();\n        fallback.setId(id);\n        fallback.setName("系统繁忙，请稍后再试");\n        fallback.setPrice(BigDecimal.ZERO);\n        return fallback;\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br")])]),n("h3",{attrs:{id:"_3-2-解决方案2-热点key永不过期-超高并发场景首选"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-解决方案2-热点key永不过期-超高并发场景首选"}},[s._v("#")]),s._v(" 3.2 解决方案2：热点key永不过期（超高并发场景首选）")]),s._v(" "),n("p",[n("strong",[s._v("核心原理")]),s._v("：不让热点key自动过期，从根源上避免失效瞬间的并发冲击，分为“物理永不过期”和“逻辑永不过期”两种方式。")]),s._v(" "),n("h4",{attrs:{id:"方式1-物理永不过期-更新频率极低场景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#方式1-物理永不过期-更新频率极低场景"}},[s._v("#")]),s._v(" 方式1：物理永不过期（更新频率极低场景）")]),s._v(" "),n("ul",[n("li",[s._v("实现：缓存不设置"),n("code",[s._v("EXPIRE")]),s._v("时间，热点数据永久存储在Redis中。")]),s._v(" "),n("li",[s._v("数据更新：数据库更新后，手动调用"),n("code",[s._v("SET")]),s._v("命令覆盖缓存（如通过消息队列异步更新）。")]),s._v(" "),n("li",[s._v("适用场景：首页Banner、固定配置、更新频率极低的热点数据（如年度爆款商品）。")])]),s._v(" "),n("h4",{attrs:{id:"方式2-逻辑永不过期-更新频率中等场景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#方式2-逻辑永不过期-更新频率中等场景"}},[s._v("#")]),s._v(" 方式2：逻辑永不过期（更新频率中等场景）")]),s._v(" "),n("ul",[n("li",[s._v("实现：缓存设置物理过期时间（如30分钟），同时启动后台异步线程，定期（如29分钟）更新过期时间，保证“逻辑上不过期”。")]),s._v(" "),n("li",[s._v("优势：兼顾可用性和数据一致性，即使后台线程故障，物理过期时间仍能兜底。")])]),s._v(" "),n("h4",{attrs:{id:"代码示例-逻辑永不过期"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代码示例-逻辑永不过期"}},[s._v("#")]),s._v(" 代码示例（逻辑永不过期）")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('@Service\npublic class HotKeyRefreshService {\n\n    @Autowired\n    private RedisTemplate<String, Object> redisTemplate;\n\n    // 热点key列表（可从配置中心/数据库动态获取）\n    private static final List<String> HOT_KEYS = Arrays.asList(\n        "goods:id:1001", "goods:id:1002", "goods:id:1003"\n    );\n\n    // 定时任务：每29分钟刷新一次过期时间（Spring Schedule）\n    @Scheduled(fixedRate = 29 * 60 * 1000)\n    @Async // 异步执行，避免阻塞主线程\n    public void refreshHotKeyExpire() {\n        log.info("开始刷新热点key过期时间");\n        for (String key : HOT_KEYS) {\n            // 检查key是否存在，存在则延长过期时间至30分钟\n            Boolean exists = redisTemplate.hasKey(key);\n            if (Boolean.TRUE.equals(exists)) {\n                redisTemplate.expire(key, 30, TimeUnit.MINUTES);\n                log.info("刷新热点key：{} 过期时间至30分钟", key);\n            }\n        }\n    }\n}\n\n// 热点key存储逻辑\npublic void cacheHotGoods(Goods goods) {\n    String cacheKey = "goods:id:" + goods.getId();\n    // 设置物理过期时间30分钟\n    redisTemplate.opsForValue().set(cacheKey, goods, 30, TimeUnit.MINUTES);\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br")])]),n("h3",{attrs:{id:"_3-3-解决方案3-逻辑过期-异步刷新-用户体验优先"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-解决方案3-逻辑过期-异步刷新-用户体验优先"}},[s._v("#")]),s._v(" 3.3 解决方案3：逻辑过期+异步刷新（用户体验优先）")]),s._v(" "),n("p",[n("strong",[s._v("核心原理")]),s._v("：缓存存储“数据+逻辑过期时间”，即使物理过期，仍返回旧数据，同时异步线程后台更新缓存，兼顾可用性和数据新鲜度（无等待时间）。")]),s._v(" "),n("h4",{attrs:{id:"实现要点-4"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实现要点-4"}},[s._v("#")]),s._v(" 实现要点")]),s._v(" "),n("ul",[n("li",[s._v("缓存封装：自定义"),n("code",[s._v("CacheWrapper")]),s._v("类，包含真实数据和逻辑过期时间。")]),s._v(" "),n("li",[s._v("物理过期时间：设为逻辑过期时间的2倍（兜底，避免缓存永久无效）。")]),s._v(" "),n("li",[s._v("异步更新：逻辑过期后，返回旧数据，同时异步获取锁更新缓存，避免并发更新。")])]),s._v(" "),n("h4",{attrs:{id:"代码示例-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代码示例-2"}},[s._v("#")]),s._v(" 代码示例")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('// 1. 封装缓存对象（含逻辑过期时间）\n@Data\npublic class CacheWrapper<T> implements Serializable {\n    private T data; // 真实数据\n    private long logicExpireTime; // 逻辑过期时间（毫秒）\n\n    // 判断是否逻辑过期\n    public boolean isExpired() {\n        return System.currentTimeMillis() > logicExpireTime;\n    }\n}\n\n// 2. 业务层实现\n@Service\npublic class GoodsService {\n\n    @Autowired\n    private RedissonClient redissonClient;\n\n    public Goods getGoodsById(Long id) {\n        String cacheKey = "goods:id:" + id;\n        String lockKey = LOCK_PREFIX + id;\n\n        // 1. 查询缓存\n        CacheWrapper<Goods> cacheWrapper = (CacheWrapper<Goods>) redisTemplate.opsForValue().get(cacheKey);\n        if (cacheWrapper == null) {\n            // 缓存未命中：走互斥锁查询DB（同3.1方案，省略）\n            return queryDbWithLock(id, cacheKey);\n        }\n\n        Goods goods = cacheWrapper.getData();\n        // 2. 逻辑未过期：直接返回数据\n        if (!cacheWrapper.isExpired()) {\n            return goods;\n        }\n\n        // 3. 逻辑过期：返回旧数据，异步更新缓存（不阻塞用户）\n        CompletableFuture.runAsync(() -> {\n            RLock lock = redissonClient.getLock(lockKey);\n            try {\n                // 尝试获取锁：非阻塞，避免并发更新\n                if (lock.tryLock(0, LOCK_EXPIRE, TimeUnit.SECONDS)) {\n                    log.info("异步更新热点key缓存：{}", cacheKey);\n                    // 查询最新数据\n                    Goods newGoods = goodsMapper.selectById(id);\n                    // 构建新缓存对象\n                    CacheWrapper<Goods> newWrapper = new CacheWrapper<>();\n                    newWrapper.setData(newGoods);\n                    // 逻辑过期时间：30分钟后\n                    newWrapper.setLogicExpireTime(System.currentTimeMillis() + 30 * 60 * 1000);\n                    // 物理过期时间：60分钟（兜底）\n                    redisTemplate.opsForValue().set(cacheKey, newWrapper, 60, TimeUnit.MINUTES);\n                }\n            } catch (InterruptedException e) {\n                Thread.currentThread().interrupt();\n                log.error("异步更新缓存失败，key：{}", cacheKey, e);\n            } finally {\n                if (lock.isHeldByCurrentThread()) {\n                    lock.unlock();\n                }\n            }\n        });\n\n        // 直接返回旧数据，保证用户体验\n        return goods;\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br")])]),n("h3",{attrs:{id:"_3-4-缓存击穿方案组合建议"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-缓存击穿方案组合建议"}},[s._v("#")]),s._v(" 3.4 缓存击穿方案组合建议")]),s._v(" "),n("ul",[n("li",[s._v("通用场景：互斥锁（兼顾一致性和并发）。")]),s._v(" "),n("li",[s._v("超高并发场景：逻辑永不过期 + 异步刷新（优先保证可用性）。")]),s._v(" "),n("li",[s._v("用户体验优先场景：逻辑过期 + 异步刷新（无等待时间）。")])]),s._v(" "),n("h2",{attrs:{id:"四、缓存雪崩-大规模失效的防护方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四、缓存雪崩-大规模失效的防护方案"}},[s._v("#")]),s._v(" 四、缓存雪崩：大规模失效的防护方案")]),s._v(" "),n("p",[s._v("缓存雪崩的核心是“缓存层整体失效”，解决方案围绕“分散失效时间”“提升缓存可用性”“限制数据库压力”展开，构建多层防护体系。")]),s._v(" "),n("h3",{attrs:{id:"_4-1-解决方案1-过期时间随机化-基础方案-必选"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-解决方案1-过期时间随机化-基础方案-必选"}},[s._v("#")]),s._v(" 4.1 解决方案1：过期时间随机化（基础方案，必选）")]),s._v(" "),n("p",[n("strong",[s._v("核心原理")]),s._v("：为每个缓存key设置“基础过期时间+随机偏移量”，避免大量key在同一时间点过期，分散流量峰值。")]),s._v(" "),n("h4",{attrs:{id:"实现要点-5"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实现要点-5"}},[s._v("#")]),s._v(" 实现要点")]),s._v(" "),n("ul",[n("li",[s._v("基础过期时间：根据数据热度设置（热数据24小时，温数据30分钟，冷数据10分钟）。")]),s._v(" "),n("li",[s._v("随机偏移量：热数据偏移量大（1~2小时），冷数据偏移量小（5~10分钟），避免偏移后仍集中过期。")]),s._v(" "),n("li",[s._v("代码封装：统一工具类生成随机过期时间，避免重复代码。")])]),s._v(" "),n("h4",{attrs:{id:"代码示例-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代码示例-3"}},[s._v("#")]),s._v(" 代码示例")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('@Component\npublic class CacheTtlUtil {\n\n    // 随机数生成器\n    private static final Random RANDOM = new Random();\n\n    /**\n     * 生成随机过期时间（秒）\n     * @param baseTtl 基础过期时间（秒）\n     * @param level 数据热度等级\n     * @return 随机过期时间（秒）\n     */\n    public int getRandomTtl(int baseTtl, HotspotLevel level) {\n        int randomRange = switch (level) {\n            case HIGH -> 2 * 3600; // 热数据：0~2小时偏移\n            case MEDIUM -> 3600; // 温数据：0~1小时偏移\n            case LOW -> 600; // 冷数据：0~10分钟偏移\n        };\n        // 随机偏移量：0 ~ randomRange 秒\n        return baseTtl + RANDOM.nextInt(randomRange);\n    }\n\n    // 数据热度等级枚举\n    public enum HotspotLevel {\n        HIGH, MEDIUM, LOW\n    }\n}\n\n// 使用示例\n@Service\npublic class GoodsService {\n\n    @Autowired\n    private CacheTtlUtil cacheTtlUtil;\n\n    public void cacheGoods(Goods goods, CacheTtlUtil.HotspotLevel level) {\n        String cacheKey = "goods:id:" + goods.getId();\n        // 基础过期时间：热数据24小时，温数据30分钟，冷数据10分钟\n        int baseTtl = switch (level) {\n            case HIGH -> 24 * 3600;\n            case MEDIUM -> 30 * 60;\n            case LOW -> 10 * 60;\n        };\n        // 生成随机过期时间\n        int randomTtl = cacheTtlUtil.getRandomTtl(baseTtl, level);\n        // 缓存数据\n        redisTemplate.opsForValue().set(cacheKey, goods, randomTtl, TimeUnit.SECONDS);\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br")])]),n("h3",{attrs:{id:"_4-2-解决方案2-多级缓存架构-提升可用性-推荐"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-解决方案2-多级缓存架构-提升可用性-推荐"}},[s._v("#")]),s._v(" 4.2 解决方案2：多级缓存架构（提升可用性，推荐）")]),s._v(" "),n("p",[n("strong",[s._v("核心原理")]),s._v("：构建“本地缓存（JVM）+ Redis”的二级缓存，即使Redis宕机，本地缓存仍能承接部分流量，避免缓存层整体失效。")]),s._v(" "),n("h4",{attrs:{id:"实现要点-6"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实现要点-6"}},[s._v("#")]),s._v(" 实现要点")]),s._v(" "),n("ul",[n("li",[s._v("本地缓存选型：推荐Caffeine（高性能、支持过期策略），避免使用HashMap（无过期和淘汰机制）。")]),s._v(" "),n("li",[s._v("本地缓存配置：最大容量1~10万（避免占用过多JVM内存），过期时间2~5分钟（短于Redis缓存，保证数据一致性）。")]),s._v(" "),n("li",[s._v("一致性保障：数据库更新时，先更新Redis，再删除本地缓存（或通过消息队列通知所有节点删除本地缓存）。")])]),s._v(" "),n("h4",{attrs:{id:"代码示例-caffeine-redis"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代码示例-caffeine-redis"}},[s._v("#")]),s._v(" 代码示例（Caffeine + Redis）")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('// 1. 配置本地缓存（Spring Boot）\n@Configuration\npublic class CaffeineConfig {\n\n    @Bean\n    public Cache<String, Object> localCache() {\n        return Caffeine.newBuilder()\n                .maximumSize(10000) // 最大缓存数量（根据内存调整）\n                .expireAfterWrite(3, TimeUnit.MINUTES) // 本地缓存过期时间：3分钟\n                .recordStats() // 开启统计（可选）\n                .build();\n    }\n}\n\n// 2. 业务层实现二级缓存\n@Service\npublic class GoodsService {\n\n    @Autowired\n    private Cache<String, Object> localCache;\n    @Autowired\n    private RedisTemplate<String, Object> redisTemplate;\n\n    public Goods getGoodsById(Long id) {\n        String cacheKey = "goods:id:" + id;\n\n        // 1. 先查本地缓存（最快）\n        Object localValue = localCache.getIfPresent(cacheKey);\n        if (localValue != null) {\n            return localValue instanceof NullValue ? null : (Goods) localValue;\n        }\n\n        // 2. 再查Redis缓存\n        Object redisValue = redisTemplate.opsForValue().get(cacheKey);\n        if (redisValue != null) {\n            // 更新本地缓存（同步数据）\n            localCache.put(cacheKey, redisValue);\n            return redisValue instanceof NullValue ? null : (Goods) redisValue;\n        }\n\n        // 3. 最后查数据库并更新缓存（省略，同前）\n        Goods goods = queryDbAndCacheResult(id, cacheKey);\n        localCache.put(cacheKey, goods == null ? new NullValue() : goods);\n        return goods;\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br")])]),n("h3",{attrs:{id:"_4-3-解决方案3-熔断降级与限流-保护数据库-兜底"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-解决方案3-熔断降级与限流-保护数据库-兜底"}},[s._v("#")]),s._v(" 4.3 解决方案3：熔断降级与限流（保护数据库，兜底）")]),s._v(" "),n("p",[n("strong",[s._v("核心原理")]),s._v("：当Redis宕机或数据库压力过大时，通过熔断降级限制请求量，返回兜底数据，避免数据库被压垮。")]),s._v(" "),n("h4",{attrs:{id:"实现示例-sentinel限流-熔断"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实现示例-sentinel限流-熔断"}},[s._v("#")]),s._v(" 实现示例（Sentinel限流 + 熔断）")]),s._v(" "),n("h5",{attrs:{id:"步骤1-添加依赖"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#步骤1-添加依赖"}},[s._v("#")]),s._v(" 步骤1：添加依赖")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("<dependency>\n    <groupId>com.alibaba.csp</groupId>\n    <artifactId>sentinel-core</artifactId>\n    <version>1.8.6</version>\n</dependency>\n<dependency>\n    <groupId>com.alibaba.csp</groupId>\n    <artifactId>sentinel-annotation-aspectj</artifactId>\n    <version>1.8.6</version>\n</dependency>\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h5",{attrs:{id:"步骤2-配置限流规则与降级逻辑"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#步骤2-配置限流规则与降级逻辑"}},[s._v("#")]),s._v(" 步骤2：配置限流规则与降级逻辑")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('// 1. 初始化Sentinel限流规则（系统启动时）\n@Configuration\npublic class SentinelConfig {\n\n    @PostConstruct\n    public void initFlowRule() {\n        // 数据库查询接口限流规则：QPS上限1000（根据DB承载能力调整）\n        FlowRule flowRule = new FlowRule();\n        flowRule.setResource("goodsDbQuery"); // 资源名（与@SentinelResource注解一致）\n        flowRule.setGrade(RuleConstant.FLOW_GRADE_QPS); // 按QPS限流\n        flowRule.setCount(1000); // QPS上限\n        FlowRuleManager.loadRules(Collections.singletonList(flowRule));\n\n        // 熔断规则：异常比例超过50%，熔断10秒\n        DegradeRule degradeRule = new DegradeRule();\n        degradeRule.setResource("goodsDbQuery");\n        degradeRule.setGrade(RuleConstant.DEGRADE_GRADE_EXCEPTION_RATIO);\n        degradeRule.setCount(0.5); // 异常比例阈值\n        degradeRule.setTimeWindow(10); // 熔断时间（秒）\n        DegradeRuleManager.loadRules(Collections.singletonList(degradeRule));\n    }\n}\n\n// 2. 业务层添加Sentinel注解\n@Service\npublic class GoodsService {\n\n    @Autowired\n    private GoodsMapper goodsMapper;\n\n    // 数据库查询方法：添加限流和熔断注解\n    @SentinelResource(\n        value = "goodsDbQuery",\n        fallback = "dbQueryFallback", // 降级兜底方法\n        blockHandler = "dbQueryBlockHandler" // 限流阻塞处理方法\n    )\n    public Goods queryDb(Long id) {\n        return goodsMapper.selectById(id);\n    }\n\n    // 降级兜底方法（异常时触发）\n    public Goods dbQueryFallback(Long id, Throwable e) {\n        log.error("数据库查询异常，id:{}", id, e);\n        return buildFallbackGoods(id);\n    }\n\n    // 限流阻塞处理方法（QPS超限时触发）\n    public Goods dbQueryBlockHandler(Long id, BlockException e) {\n        log.error("数据库查询限流，id:{}", id, e);\n        return buildFallbackGoods(id);\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br")])]),n("h3",{attrs:{id:"_4-4-解决方案4-缓存高可用部署-避免单点故障-必选"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-解决方案4-缓存高可用部署-避免单点故障-必选"}},[s._v("#")]),s._v(" 4.4 解决方案4：缓存高可用部署（避免单点故障，必选）")]),s._v(" "),n("p",[n("strong",[s._v("核心方案")]),s._v("：采用Redis Cluster或“主从+哨兵”架构，确保缓存服务无单点故障，即使部分节点宕机，仍能提供服务。")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("部署方案")]),s._v(" "),n("th",[s._v("架构说明")]),s._v(" "),n("th",[s._v("优势")]),s._v(" "),n("th",[s._v("适用场景")]),s._v(" "),n("th",[s._v("部署成本")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("主从+哨兵")]),s._v(" "),n("td",[s._v("1主N从，哨兵监控主节点，故障自动切换")]),s._v(" "),n("td",[s._v("部署简单、成本低、兼容性好")]),s._v(" "),n("td",[s._v("中小规模系统")]),s._v(" "),n("td",[s._v("低")])]),s._v(" "),n("tr",[n("td",[s._v("Redis Cluster")]),s._v(" "),n("td",[s._v("3主3从，数据自动分片，故障自愈")]),s._v(" "),n("td",[s._v("高可用、可横向扩展、支持海量数据")]),s._v(" "),n("td",[s._v("大规模、高并发系统")]),s._v(" "),n("td",[s._v("中")])])])]),s._v(" "),n("h4",{attrs:{id:"redis-cluster-配置示例-spring-boot"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#redis-cluster-配置示例-spring-boot"}},[s._v("#")]),s._v(" Redis Cluster 配置示例（Spring Boot）")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("spring:\n  redis:\n    cluster:\n      nodes: 192.168.1.101:6379,192.168.1.102:6379,192.168.1.103:6379,192.168.1.104:6379,192.168.1.105:6379,192.168.1.106:6379\n      max-redirects: 3 # 最大重定向次数（集群分片跳转）\n    lettuce:\n      pool:\n        max-active: 32 # 连接池最大活跃数\n        max-idle: 8 # 连接池最大空闲数\n        min-idle: 4 # 连接池最小空闲数\n    timeout: 3000 # 连接超时时间（毫秒）\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h3",{attrs:{id:"_4-5-解决方案5-缓存预热-避免冷启动-推荐"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-解决方案5-缓存预热-避免冷启动-推荐"}},[s._v("#")]),s._v(" 4.5 解决方案5：缓存预热（避免冷启动，推荐）")]),s._v(" "),n("p",[n("strong",[s._v("核心原理")]),s._v("：系统启动时，主动加载热点数据到缓存，避免冷启动期间大量请求穿透到数据库（如秒杀系统启动后，秒杀商品缓存为空）。")]),s._v(" "),n("h4",{attrs:{id:"实现要点-7"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实现要点-7"}},[s._v("#")]),s._v(" 实现要点")]),s._v(" "),n("ul",[n("li",[s._v("预热数据：仅加载热点数据（如秒杀商品、首页热门商品），避免全量数据预热占用过多内存。")]),s._v(" "),n("li",[s._v("预热时机：系统启动后（通过"),n("code",[s._v("CommandLineRunner")]),s._v("或"),n("code",[s._v("ApplicationRunner")]),s._v("），或流量低峰期（如凌晨2点）。")]),s._v(" "),n("li",[s._v("异步预热：批量数据预热采用异步线程池，避免阻塞系统启动。")])]),s._v(" "),n("h4",{attrs:{id:"代码示例-spring-boot-启动预热"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代码示例-spring-boot-启动预热"}},[s._v("#")]),s._v(" 代码示例（Spring Boot 启动预热）")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('@Component\npublic class CacheWarmer implements CommandLineRunner {\n\n    @Autowired\n    private RedisTemplate<String, Object> redisTemplate;\n    @Autowired\n    private GoodsMapper goodsMapper;\n    @Autowired\n    private CacheTtlUtil cacheTtlUtil;\n\n    // 热点数据：秒杀商品ID列表（可从配置中心动态获取）\n    private static final List<Long> HOT_SECKILL_GOODS_IDS = Arrays.asList(1001L, 1002L, 1003L);\n\n    @Override\n    public void run(String... args) throws Exception {\n        // 异步预热热点数据（避免阻塞系统启动）\n        CompletableFuture.runAsync(this::warmUpSeckillGoods);\n    }\n\n    // 预热秒杀商品缓存\n    private void warmUpSeckillGoods() {\n        log.info("开始预热秒杀商品缓存，共{}个商品", HOT_SECKILL_GOODS_IDS.size());\n        for (Long id : HOT_SECKILL_GOODS_IDS) {\n            try {\n                Goods goods = goodsMapper.selectById(id);\n                String cacheKey = "goods:id:" + id;\n                // 设置随机过期时间（24小时~26小时）\n                int ttl = cacheTtlUtil.getRandomTtl(24 * 3600, CacheTtlUtil.HotspotLevel.HIGH);\n                redisTemplate.opsForValue().set(cacheKey, goods, ttl, TimeUnit.SECONDS);\n                log.info("预热商品缓存成功，ID:{}", id);\n            } catch (Exception e) {\n                log.error("预热商品缓存失败，ID:{}", id, e);\n            }\n        }\n        log.info("秒杀商品缓存预热完成");\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br")])]),n("h3",{attrs:{id:"_4-6-缓存雪崩方案组合建议"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-缓存雪崩方案组合建议"}},[s._v("#")]),s._v(" 4.6 缓存雪崩方案组合建议")]),s._v(" "),n("ul",[n("li",[s._v("基础组合：过期时间随机化 + Redis高可用部署（避免大部分雪崩场景）。")]),s._v(" "),n("li",[s._v("高可用组合：过期时间随机化 + 多级缓存 + 熔断降级 + Redis Cluster（核心系统首选）。")]),s._v(" "),n("li",[s._v("冷启动防护：缓存预热（秒杀、大促场景必选）。")])]),s._v(" "),n("h2",{attrs:{id:"五、实战最佳实践与监控告警"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#五、实战最佳实践与监控告警"}},[s._v("#")]),s._v(" 五、实战最佳实践与监控告警")]),s._v(" "),n("h3",{attrs:{id:"_5-1-核心参数配置参考"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-核心参数配置参考"}},[s._v("#")]),s._v(" 5.1 核心参数配置参考")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("参数类型")]),s._v(" "),n("th",[s._v("推荐值")]),s._v(" "),n("th",[s._v("说明")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("缓存空值过期时间")]),s._v(" "),n("td",[s._v("5~10分钟")]),s._v(" "),n("td",[s._v("平衡内存占用与数据新鲜度")])]),s._v(" "),n("tr",[n("td",[s._v("布隆过滤器误判率")]),s._v(" "),n("td",[s._v("0.01%~1%")]),s._v(" "),n("td",[s._v("百万级数据推荐1%（内存占用低）")])]),s._v(" "),n("tr",[n("td",[s._v("互斥锁过期时间")]),s._v(" "),n("td",[s._v("3~5秒")]),s._v(" "),n("td",[s._v("大于DB查询+缓存更新总耗时（预留冗余）")])]),s._v(" "),n("tr",[n("td",[s._v("本地缓存过期时间")]),s._v(" "),n("td",[s._v("2~5分钟")]),s._v(" "),n("td",[s._v("短于Redis缓存，避免数据不一致")])]),s._v(" "),n("tr",[n("td",[s._v("本地缓存最大容量")]),s._v(" "),n("td",[s._v("1~10万")]),s._v(" "),n("td",[s._v("根据JVM内存调整（避免OOM）")])]),s._v(" "),n("tr",[n("td",[s._v("热点key缓存时间")]),s._v(" "),n("td",[s._v("24小时（逻辑永不过期）")]),s._v(" "),n("td",[s._v("结合异步续期机制")])]),s._v(" "),n("tr",[n("td",[s._v("限流QPS阈值")]),s._v(" "),n("td",[s._v("数据库最大承载QPS的80%")]),s._v(" "),n("td",[s._v("预留缓冲空间")])])])]),s._v(" "),n("h3",{attrs:{id:"_5-2-数据一致性保障"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-数据一致性保障"}},[s._v("#")]),s._v(" 5.2 数据一致性保障")]),s._v(" "),n("ul",[n("li",[s._v("缓存更新策略：推荐“更新数据库 + 删除缓存”（Cache-Aside模式），避免“更新缓存 + 更新数据库”的一致性问题。")]),s._v(" "),n("li",[s._v("延迟删除：删除缓存时可添加短暂延迟（如100ms），解决“数据库更新未完成，缓存已被读取”的竞态条件。")]),s._v(" "),n("li",[s._v("分布式场景：使用消息队列通知所有节点删除本地缓存，保证集群节点数据一致。")])]),s._v(" "),n("h3",{attrs:{id:"_5-3-监控告警体系-提前预警"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-监控告警体系-提前预警"}},[s._v("#")]),s._v(" 5.3 监控告警体系（提前预警）")]),s._v(" "),n("h4",{attrs:{id:"核心监控指标"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#核心监控指标"}},[s._v("#")]),s._v(" 核心监控指标")]),s._v(" "),n("ul",[n("li",[s._v("缓存层：缓存命中率（阈值≥90%）、Redis内存使用率（阈值≤85%）、Redis节点存活状态、缓存过期key数量。")]),s._v(" "),n("li",[s._v("数据库层：DB QPS（监控突发增长）、DB慢查询次数（阈值≤10次/分钟）、DB连接数（阈值≤最大连接数的80%）。")]),s._v(" "),n("li",[s._v("业务层：接口响应时间（阈值≤500ms）、降级兜底触发次数（阈值≤100次/分钟）。")])]),s._v(" "),n("h4",{attrs:{id:"监控工具组合"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#监控工具组合"}},[s._v("#")]),s._v(" 监控工具组合")]),s._v(" "),n("ul",[n("li",[s._v("采集：Prometheus + Redis Exporter + Spring Boot Actuator。")]),s._v(" "),n("li",[s._v("可视化：Grafana（配置仪表盘，实时查看指标）。")]),s._v(" "),n("li",[s._v("告警：AlertManager（支持邮件、短信、钉钉告警）。")])]),s._v(" "),n("h4",{attrs:{id:"关键告警规则"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#关键告警规则"}},[s._v("#")]),s._v(" 关键告警规则")]),s._v(" "),n("ul",[n("li",[s._v("缓存命中率低于90%（持续5分钟）。")]),s._v(" "),n("li",[s._v("Redis节点宕机（持续1分钟）。")]),s._v(" "),n("li",[s._v("DB QPS突增50%以上（持续3分钟）。")]),s._v(" "),n("li",[s._v("接口响应时间超过1秒（持续5分钟）。")])]),s._v(" "),n("h2",{attrs:{id:"六、总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#六、总结"}},[s._v("#")]),s._v(" 六、总结")]),s._v(" "),n("p",[s._v("Redis缓存三大问题的本质是“缓存未命中后的流量失控”，解决方案的核心思路是："),n("strong",[s._v("提前拦截无效请求、控制并发查询流量、提升缓存可用性、保护数据库底线")]),s._v("。")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("问题类型")]),s._v(" "),n("th",[s._v("核心解决方案")]),s._v(" "),n("th",[s._v("推荐组合")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("缓存穿透")]),s._v(" "),n("td",[s._v("布隆过滤器、缓存空值")]),s._v(" "),n("td",[s._v("接口校验 + 布隆过滤器 + 缓存空值")])]),s._v(" "),n("tr",[n("td",[s._v("缓存击穿")]),s._v(" "),n("td",[s._v("互斥锁、逻辑永不过期")]),s._v(" "),n("td",[s._v("互斥锁 + 逻辑过期异步刷新")])]),s._v(" "),n("tr",[n("td",[s._v("缓存雪崩")]),s._v(" "),n("td",[s._v("随机TTL、多级缓存、高可用部署")]),s._v(" "),n("td",[s._v("随机TTL + 多级缓存 + Redis Cluster + 熔断降级")])])])]),s._v(" "),n("p",[s._v("实际落地时，需根据业务场景灵活选择方案：中小规模系统可优先使用“缓存空值+随机TTL+互斥锁”的轻量方案；大规模高并发系统则需组合“布隆过滤器+多级缓存+Redis Cluster+熔断降级”的全方位防护体系。")]),s._v(" "),n("p",[s._v("优先使用Redisson、RedisBloom、Caffeine等成熟框架，避免重复造轮子，同时通过监控告警提前发现风险，确保缓存体系稳定可靠。")])])}),[],!1,null,null,null);n.default=t.exports}}]);