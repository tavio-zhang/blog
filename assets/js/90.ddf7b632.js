(window.webpackJsonp=window.webpackJsonp||[]).push([[90],{446:function(e,s,n){"use strict";n.r(s);var t=n(8),a=Object(t.a)({},(function(){var e=this,s=e._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("p",[e._v("异步编程是提升系统性能与响应速度的核心手段。JDK 8引入的"),s("code",[e._v("CompletableFuture")]),e._v("彻底改变了传统异步编程的模式，它不仅解决了"),s("code",[e._v("Future")]),e._v("接口的固有缺陷，更提供了强大的任务编排能力，让复杂异步流程的实现变得简洁而高效。")]),e._v(" "),s("h3",{attrs:{id:"为什么需要completablefuture"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么需要completablefuture"}},[e._v("#")]),e._v(" 为什么需要CompletableFuture？")]),e._v(" "),s("p",[e._v("在JDK 8之前，"),s("code",[e._v("Future")]),e._v("接口是处理异步任务的主要方式，但它在面对复杂业务场景时暴露了明显局限性：")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("阻塞式结果获取")]),e._v("："),s("code",[e._v("get()")]),e._v("方法会强制阻塞当前线程，直到任务完成，无法实现真正的异步回调，严重影响并发性能。")]),e._v(" "),s("li",[s("strong",[e._v("任务依赖管理复杂")]),e._v("：多个异步任务的串行/并行依赖需要手动控制（如A完成后执行B），代码耦合度高且易出错。")]),e._v(" "),s("li",[s("strong",[e._v("异常处理缺失")]),e._v("：仅能在"),s("code",[e._v("get()")]),e._v("时捕获异常，无法在任务执行过程中异步处理，灵活性极差。")]),e._v(" "),s("li",[s("strong",[e._v("任务组合能力弱")]),e._v("：多个并行任务的结果合并需要编写大量模板代码，逻辑繁琐。")])]),e._v(" "),s("p",[s("code",[e._v("CompletableFuture")]),e._v("针对这些痛点设计，核心优势包括：")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("非阻塞回调机制")]),e._v("：通过"),s("code",[e._v("thenAccept")]),e._v("、"),s("code",[e._v("thenApply")]),e._v("等API实现结果的异步消费，避免线程阻塞。")]),e._v(" "),s("li",[s("strong",[e._v("灵活的任务编排")]),e._v("：支持串行、并行、竞速、批量等多种任务组合方式，轻松实现复杂流程。")]),e._v(" "),s("li",[s("strong",[e._v("完善的异常处理")]),e._v("：提供"),s("code",[e._v("exceptionally")]),e._v("、"),s("code",[e._v("handle")]),e._v("等API，支持异常的异步捕获与处理。")]),e._v(" "),s("li",[s("strong",[e._v("自定义线程池")]),e._v("：可摆脱默认"),s("code",[e._v("ForkJoinPool")]),e._v("的资源竞争问题，更贴合生产环境需求。")]),e._v(" "),s("li",[s("strong",[e._v("链式编程支持")]),e._v("：与Stream API风格一致，代码可读性与可维护性大幅提升。")])]),e._v(" "),s("h2",{attrs:{id:"快速入门"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#快速入门"}},[e._v("#")]),e._v(" 快速入门")]),e._v(" "),s("p",[s("code",[e._v("CompletableFuture")]),e._v("提供了两类静态方法创建异步任务，核心区别在于是否需要返回值。")]),e._v(" "),s("h3",{attrs:{id:"_1-核心创建方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-核心创建方法"}},[e._v("#")]),e._v(" 1. 核心创建方法")]),e._v(" "),s("table",[s("thead",[s("tr",[s("th",[e._v("方法")]),e._v(" "),s("th",[e._v("特点")]),e._v(" "),s("th",[e._v("适用场景")])])]),e._v(" "),s("tbody",[s("tr",[s("td",[s("code",[e._v("supplyAsync")])]),e._v(" "),s("td",[e._v("有返回值，返回"),s("code",[e._v("CompletableFuture<T>")])]),e._v(" "),s("td",[e._v("查询数据库、调用远程接口等需要结果的任务")])]),e._v(" "),s("tr",[s("td",[s("code",[e._v("runAsync")])]),e._v(" "),s("td",[e._v("无返回值，返回"),s("code",[e._v("CompletableFuture<Void>")])]),e._v(" "),s("td",[e._v("日志记录、缓存更新等无需结果的任务")])])])]),e._v(" "),s("h4",{attrs:{id:"示例1-默认线程池创建任务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#示例1-默认线程池创建任务"}},[e._v("#")]),e._v(" 示例1：默认线程池创建任务")]),e._v(" "),s("p",[e._v("默认情况下，"),s("code",[e._v("supplyAsync")]),e._v("和"),s("code",[e._v("runAsync")]),e._v("会使用JVM共享的"),s("code",[e._v("ForkJoinPool.commonPool()")]),e._v("，适用于简单场景：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('public static void main(String[] args) throws Exception {\n    // 有返回值任务\n    CompletableFuture<String> resultFuture = CompletableFuture.supplyAsync(() -> {\n        try {\n            // 模拟耗时操作（如查询数据库）\n            Thread.sleep(1000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        return "查询结果";\n    });\n\n    // 无返回值任务\n    CompletableFuture<Void> voidFuture = CompletableFuture.runAsync(() -> {\n        try {\n            // 模拟耗时操作（如日志记录）\n            Thread.sleep(1000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        System.out.println("日志记录完成");\n    });\n\n    // 阻塞获取结果（仅示例用，生产环境不推荐）\n    System.out.println(resultFuture.get()); // 输出：查询结果\n    voidFuture.get(); // 等待任务完成\n}\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br"),s("span",{staticClass:"line-number"},[e._v("24")]),s("br"),s("span",{staticClass:"line-number"},[e._v("25")]),s("br"),s("span",{staticClass:"line-number"},[e._v("26")]),s("br"),s("span",{staticClass:"line-number"},[e._v("27")]),s("br")])]),s("h4",{attrs:{id:"示例2-自定义线程池创建任务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#示例2-自定义线程池创建任务"}},[e._v("#")]),e._v(" 示例2：自定义线程池创建任务")]),e._v(" "),s("p",[e._v("生产环境中，"),s("strong",[e._v("必须使用自定义线程池")]),e._v("（避免共享线程池的资源竞争）。线程池配置建议：")]),e._v(" "),s("ul",[s("li",[e._v("核心线程数：根据CPU核心数或业务场景设置（如"),s("code",[e._v("Runtime.getRuntime().availableProcessors() + 1")]),e._v("）")]),e._v(" "),s("li",[e._v("队列选择：使用有界队列（如"),s("code",[e._v("ArrayBlockingQueue")]),e._v("）避免内存溢出")]),e._v(" "),s("li",[e._v("拒绝策略：结合业务设置（如"),s("code",[e._v("CallerRunsPolicy")]),e._v("在高负载时降级）")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('// 自定义线程池（生产环境推荐）\nprivate static final ThreadPoolExecutor CUSTOM_EXECUTOR = new ThreadPoolExecutor(\n        2, // 核心线程数\n        4, // 最大线程数\n        60, TimeUnit.SECONDS, // 空闲线程存活时间\n        new ArrayBlockingQueue<>(10), // 有界队列\n        new ThreadPoolExecutor.CallerRunsPolicy() // 拒绝策略：让提交任务的线程执行\n);\n\npublic static void main(String[] args) throws Exception {\n    // 使用自定义线程池执行有返回值任务\n    CompletableFuture<String> future = CompletableFuture.supplyAsync(() -> {\n        try {\n            Thread.sleep(1000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        return "自定义线程池执行结果";\n    }, CUSTOM_EXECUTOR);\n\n    // 非阻塞处理结果（推荐）\n    future.thenAccept(result -> System.out.println("异步处理：" + result));\n\n    // 主线程继续执行其他逻辑\n    System.out.println("主线程无需等待");\n\n    // 关闭线程池（实际应用中应在程序退出时关闭）\n    CUSTOM_EXECUTOR.shutdown();\n}\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br"),s("span",{staticClass:"line-number"},[e._v("24")]),s("br"),s("span",{staticClass:"line-number"},[e._v("25")]),s("br"),s("span",{staticClass:"line-number"},[e._v("26")]),s("br"),s("span",{staticClass:"line-number"},[e._v("27")]),s("br"),s("span",{staticClass:"line-number"},[e._v("28")]),s("br"),s("span",{staticClass:"line-number"},[e._v("29")]),s("br")])]),s("h3",{attrs:{id:"_2-结果获取方式对比"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-结果获取方式对比"}},[e._v("#")]),e._v(" 2. 结果获取方式对比")]),e._v(" "),s("table",[s("thead",[s("tr",[s("th",[e._v("方式")]),e._v(" "),s("th",[e._v("特点")]),e._v(" "),s("th",[e._v("适用场景")]),e._v(" "),s("th",[e._v("推荐度")])])]),e._v(" "),s("tbody",[s("tr",[s("td",[s("code",[e._v("get()")])]),e._v(" "),s("td",[e._v("阻塞当前线程，抛出受检异常（需捕获）")]),e._v(" "),s("td",[e._v("必须同步获取结果的场景")]),e._v(" "),s("td",[e._v("不推荐")])]),e._v(" "),s("tr",[s("td",[s("code",[e._v("join()")])]),e._v(" "),s("td",[e._v("阻塞当前线程，抛出非受检异常（无需捕获）")]),e._v(" "),s("td",[e._v("必须同步获取结果且简化异常处理")]),e._v(" "),s("td",[e._v("不推荐")])]),e._v(" "),s("tr",[s("td",[s("code",[e._v("thenAccept()")])]),e._v(" "),s("td",[e._v("异步消费结果，非阻塞，无返回值")]),e._v(" "),s("td",[e._v("仅需处理结果无需后续计算")]),e._v(" "),s("td",[e._v("推荐")])]),e._v(" "),s("tr",[s("td",[s("code",[e._v("whenComplete()")])]),e._v(" "),s("td",[e._v("异步处理结果+异常，非阻塞，不改变结果")]),e._v(" "),s("td",[e._v("需要处理结果且记录日志/释放资源")]),e._v(" "),s("td",[e._v("推荐")])])])]),e._v(" "),s("p",[s("strong",[e._v("注意")]),e._v("：尽量避免使用"),s("code",[e._v("get()")]),e._v("和"),s("code",[e._v("join()")]),e._v("，它们会阻塞线程，违背异步编程初衷。优先使用非阻塞的回调方法。")]),e._v(" "),s("h2",{attrs:{id:"任务编排核心技巧"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#任务编排核心技巧"}},[e._v("#")]),e._v(" 任务编排核心技巧")]),e._v(" "),s("p",[s("code",[e._v("CompletableFuture")]),e._v("的精髓在于灵活的任务编排，通过API可将多个异步任务组合成复杂流程，无需手动管理依赖关系。")]),e._v(" "),s("h3",{attrs:{id:"_1-串行编排-a完成后执行b"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-串行编排-a完成后执行b"}},[e._v("#")]),e._v(" 1. 串行编排（A完成后执行B）")]),e._v(" "),s("p",[e._v("适用于任务存在依赖关系的场景（如B需要A的结果作为输入）。")]),e._v(" "),s("table",[s("thead",[s("tr",[s("th",[e._v("API")]),e._v(" "),s("th",[e._v("特点")]),e._v(" "),s("th",[e._v("示例场景")])])]),e._v(" "),s("tbody",[s("tr",[s("td",[s("code",[e._v("thenApply")])]),e._v(" "),s("td",[e._v("接收前序结果，返回新结果（有返回值）")]),e._v(" "),s("td",[e._v("A查询商品原价，B计算折扣价")])]),e._v(" "),s("tr",[s("td",[s("code",[e._v("thenAccept")])]),e._v(" "),s("td",[e._v("接收前序结果，消费结果（无返回值）")]),e._v(" "),s("td",[e._v("A查询价格后，B打印价格")])]),e._v(" "),s("tr",[s("td",[s("code",[e._v("thenRun")])]),e._v(" "),s("td",[e._v("不依赖前序结果，执行后续操作")]),e._v(" "),s("td",[e._v("A完成后，B记录操作日志")])])])]),e._v(" "),s("p",[s("strong",[e._v("示例")]),e._v("：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('// 任务1：查询商品原价\nCompletableFuture<Double> priceFuture = CompletableFuture.supplyAsync(() -> {\n    System.out.println("查询原价（线程：" + Thread.currentThread().getName() + "）");\n    return 99.99;\n}, CUSTOM_EXECUTOR);\n\n// 任务2：基于原价计算折扣价（依赖任务1结果）\nCompletableFuture<Double> discountFuture = priceFuture.thenApply(price -> {\n    System.out.println("计算折扣（线程：" + Thread.currentThread().getName() + "）");\n    return price * 0.8; // 8折\n});\n\n// 任务3：消费折扣价结果（依赖任务2结果）\ndiscountFuture.thenAccept(finalPrice -> {\n    System.out.println("最终价格：" + finalPrice + "（线程：" + Thread.currentThread().getName() + "）");\n});\n\n// 任务4：不依赖前序结果，执行收尾操作\npriceFuture.thenRun(() -> {\n    System.out.println("价格查询流程结束（线程：" + Thread.currentThread().getName() + "）");\n});\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br")])]),s("p",[s("strong",[e._v("说明")]),e._v("：默认情况下，后续任务会复用前序任务的线程（若前序已完成则使用当前线程），也可通过"),s("code",[e._v("thenApplyAsync")]),e._v("等方法强制使用异步线程池。")]),e._v(" "),s("h3",{attrs:{id:"_2-并行合并-a和b都完成后合并结果"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-并行合并-a和b都完成后合并结果"}},[e._v("#")]),e._v(" 2. 并行合并（A和B都完成后合并结果）")]),e._v(" "),s("p",[e._v("适用于需要并行执行多个独立任务，最终合并结果的场景（如查询商品信息+查询库存，合并后展示）。")]),e._v(" "),s("table",[s("thead",[s("tr",[s("th",[e._v("API")]),e._v(" "),s("th",[e._v("特点")])])]),e._v(" "),s("tbody",[s("tr",[s("td",[s("code",[e._v("thenCombine")])]),e._v(" "),s("td",[e._v("合并两个任务结果，返回新结果（有返回值）")])]),e._v(" "),s("tr",[s("td",[s("code",[e._v("thenAcceptBoth")])]),e._v(" "),s("td",[e._v("消费两个任务结果，无返回值")])])])]),e._v(" "),s("p",[s("strong",[e._v("示例")]),e._v("：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('// 任务1：查询商品名称\nCompletableFuture<String> nameFuture = CompletableFuture.supplyAsync(() -> {\n    try { Thread.sleep(500); } catch (InterruptedException e) { e.printStackTrace(); }\n    return "iPhone 15";\n}, CUSTOM_EXECUTOR);\n\n// 任务2：查询商品库存\nCompletableFuture<Integer> stockFuture = CompletableFuture.supplyAsync(() -> {\n    try { Thread.sleep(800); } catch (InterruptedException e) { e.printStackTrace(); }\n    return 100;\n}, CUSTOM_EXECUTOR);\n\n// 合并结果：商品名称 + 库存\nnameFuture.thenCombine(stockFuture, (name, stock) -> {\n    return "商品：" + name + "，库存：" + stock;\n}).thenAccept(combinedResult -> {\n    System.out.println("合并结果：" + combinedResult); // 输出：商品：iPhone 15，库存：100\n});\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br")])]),s("h3",{attrs:{id:"_3-竞速编排-a或b任意一个完成后处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-竞速编排-a或b任意一个完成后处理"}},[e._v("#")]),e._v(" 3. 竞速编排（A或B任意一个完成后处理）")]),e._v(" "),s("p",[e._v("适用于多渠道获取数据，取最快结果的场景（如从多个CDN获取资源，选响应最快的）。")]),e._v(" "),s("table",[s("thead",[s("tr",[s("th",[e._v("API")]),e._v(" "),s("th",[e._v("特点")])])]),e._v(" "),s("tbody",[s("tr",[s("td",[s("code",[e._v("applyToEither")])]),e._v(" "),s("td",[e._v("任意任务完成后，处理结果并返回新值")])]),e._v(" "),s("tr",[s("td",[s("code",[e._v("acceptEither")])]),e._v(" "),s("td",[e._v("任意任务完成后，消费其结果")])])])]),e._v(" "),s("p",[s("strong",[e._v("示例")]),e._v("：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('// 渠道1：淘宝查询价格（耗时800ms）\nCompletableFuture<Double> taobaoFuture = CompletableFuture.supplyAsync(() -> {\n    try { Thread.sleep(800); } catch (InterruptedException e) { e.printStackTrace(); }\n    return 8999.0;\n}, CUSTOM_EXECUTOR);\n\n// 渠道2：京东查询价格（耗时500ms）\nCompletableFuture<Double> jdFuture = CompletableFuture.supplyAsync(() -> {\n    try { Thread.sleep(500); } catch (InterruptedException e) { e.printStackTrace(); }\n    return 8990.0;\n}, CUSTOM_EXECUTOR);\n\n// 取最快返回的价格\ntaobaoFuture.acceptEither(jdFuture, price -> {\n    System.out.println("最快价格：" + price); // 输出：8990.0（京东更快）\n});\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br")])]),s("h3",{attrs:{id:"_4-批量编排-多个任务统一处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-批量编排-多个任务统一处理"}},[e._v("#")]),e._v(" 4. 批量编排（多个任务统一处理）")]),e._v(" "),s("p",[e._v("适用于批量执行异步任务，等待全部完成或任意一个完成后统一处理的场景。")]),e._v(" "),s("table",[s("thead",[s("tr",[s("th",[e._v("API")]),e._v(" "),s("th",[e._v("特点")]),e._v(" "),s("th",[e._v("适用场景")])])]),e._v(" "),s("tbody",[s("tr",[s("td",[s("code",[e._v("allOf")])]),e._v(" "),s("td",[e._v("等待所有任务完成，返回"),s("code",[e._v("CompletableFuture<Void>")])]),e._v(" "),s("td",[e._v("批量任务全部完成后汇总结果")])]),e._v(" "),s("tr",[s("td",[s("code",[e._v("anyOf")])]),e._v(" "),s("td",[e._v("等待任意一个任务完成，返回第一个结果")]),e._v(" "),s("td",[e._v("多任务取第一个完成的结果")])])])]),e._v(" "),s("p",[s("strong",[e._v("示例：allOf（等待全部完成）")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('// 批量任务：查询3个商品的价格\nCompletableFuture<Double> p1 = CompletableFuture.supplyAsync(() -> 1000.0, CUSTOM_EXECUTOR);\nCompletableFuture<Double> p2 = CompletableFuture.supplyAsync(() -> 2000.0, CUSTOM_EXECUTOR);\nCompletableFuture<Double> p3 = CompletableFuture.supplyAsync(() -> 3000.0, CUSTOM_EXECUTOR);\n\n// 等待所有任务完成（返回Void，需手动获取子任务结果）\nCompletableFuture<Void> allDone = CompletableFuture.allOf(p1, p2, p3);\n\n// 所有任务完成后汇总总价\nallDone.thenRun(() -> {\n    try {\n        double total = p1.get() + p2.get() + p3.get();\n        System.out.println("商品总价：" + total); // 输出：6000.0\n    } catch (Exception e) {\n        e.printStackTrace();\n    }\n});\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br")])]),s("p",[s("strong",[e._v("示例：anyOf（等待任意一个完成）")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('// 3个任务分别模拟不同响应时间\nCompletableFuture<String> task1 = CompletableFuture.supplyAsync(() -> {\n    try { Thread.sleep(300); } catch (InterruptedException e) { e.printStackTrace(); }\n    return "任务1完成";\n}, CUSTOM_EXECUTOR);\n\nCompletableFuture<String> task2 = CompletableFuture.supplyAsync(() -> {\n    try { Thread.sleep(100); } catch (InterruptedException e) { e.printStackTrace(); }\n    return "任务2完成";\n}, CUSTOM_EXECUTOR);\n\nCompletableFuture<String> task3 = CompletableFuture.supplyAsync(() -> {\n    try { Thread.sleep(200); } catch (InterruptedException e) { e.printStackTrace(); }\n    return "任务3完成";\n}, CUSTOM_EXECUTOR);\n\n// 等待第一个完成的任务\nCompletableFuture<Object> firstDone = CompletableFuture.anyOf(task1, task2, task3);\nfirstDone.thenAccept(result -> {\n    System.out.println("第一个完成的任务：" + result); // 输出：任务2完成\n});\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br")])]),s("h2",{attrs:{id:"异常处理机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#异常处理机制"}},[e._v("#")]),e._v(" 异常处理机制")]),e._v(" "),s("p",[e._v("异步任务的异常处理至关重要，"),s("code",[e._v("CompletableFuture")]),e._v("提供了三类核心API覆盖不同场景。")]),e._v(" "),s("h3",{attrs:{id:"_1-exceptionally-异常兜底-返回默认值"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-exceptionally-异常兜底-返回默认值"}},[e._v("#")]),e._v(" 1. "),s("code",[e._v("exceptionally")]),e._v("：异常兜底（返回默认值）")]),e._v(" "),s("p",[e._v("适用于任务失败时需要返回兜底结果的场景（如查询失败返回默认价格）。")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('CompletableFuture<Double> priceFuture = CompletableFuture.supplyAsync(() -> {\n    // 模拟任务异常（除以0）\n    int error = 10 / 0;\n    return 8999.0;\n}, CUSTOM_EXECUTOR);\n\n// 异常时返回默认值0.0\npriceFuture.exceptionally(e -> {\n    System.err.println("异常原因：" + e.getMessage()); // 输出：/ by zero\n    return 0.0; // 兜底值\n}).thenAccept(price -> {\n    System.out.println("最终价格：" + price); // 输出：0.0\n});\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br")])]),s("h3",{attrs:{id:"_2-handle-统一处理结果与异常"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-handle-统一处理结果与异常"}},[e._v("#")]),e._v(" 2. "),s("code",[e._v("handle")]),e._v("：统一处理结果与异常")]),e._v(" "),s("p",[e._v("适用于无论任务成功/失败都需要处理的场景（如成功计算折扣，失败返回默认值）。")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('CompletableFuture<Double> priceFuture = CompletableFuture.supplyAsync(() -> {\n    // 模拟任务异常\n    int error = 10 / 0;\n    return 8999.0;\n}, CUSTOM_EXECUTOR);\n\n// handle接收两个参数：result（成功时非null）、e（失败时非null）\npriceFuture.handle((result, e) -> {\n    if (e != null) {\n        System.err.println("任务失败：" + e.getMessage());\n        return 0.0; // 异常兜底\n    }\n    return result * 0.9; // 成功时计算9折\n}).thenAccept(finalPrice -> {\n    System.out.println("最终价格：" + finalPrice); // 输出：0.0\n});\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br")])]),s("h3",{attrs:{id:"_3-whencomplete-收尾操作-不改变结果"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-whencomplete-收尾操作-不改变结果"}},[e._v("#")]),e._v(" 3. "),s("code",[e._v("whenComplete")]),e._v("：收尾操作（不改变结果）")]),e._v(" "),s("p",[e._v("适用于任务完成后需要记录日志、释放资源等收尾操作，不影响原有结果流转。")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('CompletableFuture<Double> priceFuture = CompletableFuture.supplyAsync(() -> {\n    return 8999.0; // 正常返回结果\n}, CUSTOM_EXECUTOR);\n\n// 无论成功/失败都执行收尾操作\npriceFuture.whenComplete((result, e) -> {\n    if (e == null) {\n        System.out.println("任务成功，结果：" + result); // 输出：任务成功，结果：8999.0\n    } else {\n        System.err.println("任务失败：" + e.getMessage());\n    }\n}).thenApply(price -> price * 0.9) // 继续处理结果（不受whenComplete影响）\n  .thenAccept(discountPrice -> {\n      System.out.println("折扣价：" + discountPrice); // 输出：8099.1\n  });\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br")])]),s("h3",{attrs:{id:"异常处理最佳实践"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#异常处理最佳实践"}},[e._v("#")]),e._v(" 异常处理最佳实践")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("异常传递")]),e._v("：前序任务的异常会传递到后续任务，若中间未处理，最终会在"),s("code",[e._v("get()")]),e._v("/"),s("code",[e._v("join()")]),e._v("时抛出。")]),e._v(" "),s("li",[s("strong",[e._v("避免异常吞噬")]),e._v("：务必为每个关键任务添加异常处理（至少在链路末尾添加），防止异常被静默忽略。")]),e._v(" "),s("li",[s("strong",[e._v("多层处理")]),e._v("：复杂链路中可在不同阶段添加异常处理（如局部异常局部处理，全局异常统一兜底）。")])]),e._v(" "),s("h2",{attrs:{id:"实战场景示例-电商下单流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实战场景示例-电商下单流程"}},[e._v("#")]),e._v(" 实战场景示例：电商下单流程")]),e._v(" "),s("p",[e._v("假设一个简化的电商下单流程：")]),e._v(" "),s("ol",[s("li",[e._v("查询商品信息（名称、原价）")]),e._v(" "),s("li",[e._v("检查库存是否充足")]),e._v(" "),s("li",[e._v("计算折扣后价格（依赖商品原价）")]),e._v(" "),s("li",[e._v("生成订单（依赖商品信息、库存、最终价格）")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('// 1. 查询商品信息（名称+原价）\nCompletableFuture<Product> productFuture = CompletableFuture.supplyAsync(() -> {\n    System.out.println("查询商品信息");\n    return new Product("iPhone 15", 8999.0);\n}, CUSTOM_EXECUTOR);\n\n// 2. 检查库存\nCompletableFuture<Integer> stockFuture = CompletableFuture.supplyAsync(() -> {\n    System.out.println("检查库存");\n    return 100; // 库存100\n}, CUSTOM_EXECUTOR);\n\n// 3. 计算折扣价（依赖商品原价）\nCompletableFuture<Double> discountFuture = productFuture.thenApply(product -> {\n    System.out.println("计算折扣价（8折）");\n    return product.getPrice() * 0.8;\n});\n\n// 4. 合并结果生成订单（依赖商品信息、库存、折扣价）\nCompletableFuture<Order> orderFuture = productFuture.thenCombine(stockFuture, (product, stock) -> {\n    return new OrderTemp(product, stock); // 临时对象存储中间结果\n}).thenCombine(discountFuture, (temp, discountPrice) -> {\n    System.out.println("生成订单");\n    return new Order(\n        temp.product.getName(),\n        temp.stock,\n        discountPrice,\n        System.currentTimeMillis()\n    );\n});\n\n// 处理最终订单结果\norderFuture.whenComplete((order, e) -> {\n    if (e == null) {\n        System.out.println("下单成功：" + order);\n    } else {\n        System.err.println("下单失败：" + e.getMessage());\n    }\n});\n\n// 辅助类\nclass Product {\n    private String name;\n    private Double price;\n    // 构造器、getter省略\n}\n\nclass OrderTemp {\n    Product product;\n    Integer stock;\n    // 构造器省略\n}\n\nclass Order {\n    private String productName;\n    private Integer stock;\n    private Double finalPrice;\n    private Long createTime;\n    // 构造器、toString省略\n}\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br"),s("span",{staticClass:"line-number"},[e._v("24")]),s("br"),s("span",{staticClass:"line-number"},[e._v("25")]),s("br"),s("span",{staticClass:"line-number"},[e._v("26")]),s("br"),s("span",{staticClass:"line-number"},[e._v("27")]),s("br"),s("span",{staticClass:"line-number"},[e._v("28")]),s("br"),s("span",{staticClass:"line-number"},[e._v("29")]),s("br"),s("span",{staticClass:"line-number"},[e._v("30")]),s("br"),s("span",{staticClass:"line-number"},[e._v("31")]),s("br"),s("span",{staticClass:"line-number"},[e._v("32")]),s("br"),s("span",{staticClass:"line-number"},[e._v("33")]),s("br"),s("span",{staticClass:"line-number"},[e._v("34")]),s("br"),s("span",{staticClass:"line-number"},[e._v("35")]),s("br"),s("span",{staticClass:"line-number"},[e._v("36")]),s("br"),s("span",{staticClass:"line-number"},[e._v("37")]),s("br"),s("span",{staticClass:"line-number"},[e._v("38")]),s("br"),s("span",{staticClass:"line-number"},[e._v("39")]),s("br"),s("span",{staticClass:"line-number"},[e._v("40")]),s("br"),s("span",{staticClass:"line-number"},[e._v("41")]),s("br"),s("span",{staticClass:"line-number"},[e._v("42")]),s("br"),s("span",{staticClass:"line-number"},[e._v("43")]),s("br"),s("span",{staticClass:"line-number"},[e._v("44")]),s("br"),s("span",{staticClass:"line-number"},[e._v("45")]),s("br"),s("span",{staticClass:"line-number"},[e._v("46")]),s("br"),s("span",{staticClass:"line-number"},[e._v("47")]),s("br"),s("span",{staticClass:"line-number"},[e._v("48")]),s("br"),s("span",{staticClass:"line-number"},[e._v("49")]),s("br"),s("span",{staticClass:"line-number"},[e._v("50")]),s("br"),s("span",{staticClass:"line-number"},[e._v("51")]),s("br"),s("span",{staticClass:"line-number"},[e._v("52")]),s("br"),s("span",{staticClass:"line-number"},[e._v("53")]),s("br"),s("span",{staticClass:"line-number"},[e._v("54")]),s("br"),s("span",{staticClass:"line-number"},[e._v("55")]),s("br"),s("span",{staticClass:"line-number"},[e._v("56")]),s("br"),s("span",{staticClass:"line-number"},[e._v("57")]),s("br"),s("span",{staticClass:"line-number"},[e._v("58")]),s("br"),s("span",{staticClass:"line-number"},[e._v("59")]),s("br"),s("span",{staticClass:"line-number"},[e._v("60")]),s("br")])]),s("h2",{attrs:{id:"注意事项与最佳实践"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注意事项与最佳实践"}},[e._v("#")]),e._v(" 注意事项与最佳实践")]),e._v(" "),s("ol",[s("li",[s("p",[s("strong",[e._v("线程池管理")]),e._v("：")]),e._v(" "),s("ul",[s("li",[e._v("生产环境必须使用自定义线程池，避免使用默认"),s("code",[e._v("ForkJoinPool")]),e._v("。")]),e._v(" "),s("li",[e._v("线程池参数需根据业务压测调整，核心线程数不宜过大（避免上下文切换开销）。")]),e._v(" "),s("li",[e._v("任务完成后及时关闭线程池（或通过Spring等框架管理生命周期）。")])])]),e._v(" "),s("li",[s("p",[s("strong",[e._v("避免过度异步")]),e._v("：")]),e._v(" "),s("ul",[s("li",[e._v("简单同步任务无需强行异步化（异步有线程调度开销）。")]),e._v(" "),s("li",[e._v("异步链路不宜过长，否则会增加调试难度。")])])]),e._v(" "),s("li",[s("p",[s("strong",[e._v("结果获取规范")]),e._v("：")]),e._v(" "),s("ul",[s("li",[e._v("禁止在异步链路中使用"),s("code",[e._v("get()")]),e._v("/"),s("code",[e._v("join()")]),e._v("（会阻塞线程），除非确保任务已完成（如"),s("code",[e._v("allOf")]),e._v("之后）。")]),e._v(" "),s("li",[e._v("必须使用"),s("code",[e._v("get()")]),e._v("时，建议设置超时时间（"),s("code",[e._v("get(1, TimeUnit.SECONDS)")]),e._v("），避免永久阻塞。")])])]),e._v(" "),s("li",[s("p",[s("strong",[e._v("异常处理完整性")]),e._v("：")]),e._v(" "),s("ul",[s("li",[e._v("所有异步链路必须添加异常处理，防止异常被吞噬导致问题排查困难。")]),e._v(" "),s("li",[e._v("复杂链路建议在关键节点添加"),s("code",[e._v("whenComplete")]),e._v("记录日志，便于追踪流程。")])])])]),e._v(" "),s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[e._v("#")]),e._v(" 总结")]),e._v(" "),s("p",[s("code",[e._v("CompletableFuture")]),e._v("通过强大的异步编排与异常处理能力，彻底解决了传统"),s("code",[e._v("Future")]),e._v("的局限性，是Java异步编程的首选方案。")]),e._v(" "),s("p",[e._v("在实际开发中，需注意线程池的合理配置、避免阻塞调用、确保异常处理完整，才能充分发挥"),s("code",[e._v("CompletableFuture")]),e._v("的优势。")])])}),[],!1,null,null,null);s.default=a.exports}}]);